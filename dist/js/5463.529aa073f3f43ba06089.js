"use strict";(self.webpackChunkreact_webpack=self.webpackChunkreact_webpack||[]).push([[5463],{93971:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Q});var s=t(58548),a=t.n(s),r=t(78829),i=t.n(r),l=t(51765),o=t.n(l),c=t(93287),d=t.n(c),u=t(24309),p=t.n(u),h=t(33929),m=t.n(h),f=t(63497),v=t.n(f),x=t(69984),j=t.n(x),b=t(74720),g=t.n(b),y=t(9830),N=t.n(y),_=t(30695),w=t.n(_),Z=t(83507),C=t.n(Z),S=t(69024),D=t.n(S),k=t(600),M=t.n(k),P=t(85893),R=t(67294),T=t(49101),E=t(58975),V=t(34041),F=t(48086),B=t(14617),O=t(47933),L=t(71577),q=t(10438),W=t(29713),A=t(43926),G=t(67741),H=t(7791);function I(e,n){var t=m()(e);if(p()){var s=p()(e);n&&(s=s.filter((function(n){return d()(e,n).enumerable}))),t.push.apply(t,s)}return t}function z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?I(Object(t),!0).forEach((function(n){j()(e,n,t[n])})):o()?i()(e,o()(t)):I(Object(t)).forEach((function(n){a()(e,n,d()(t,n))}))}return e}var J=V.Z.Option;const Q=function(e){C()(a,e);var n,t,s=(n=a,t=function(){if("undefined"==typeof Reflect||!v())return!1;if(v().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(v()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=M()(n);if(t){var a=M()(this).constructor;e=v()(s,arguments,a)}else e=s.apply(this,arguments);return D()(this,e)});function a(e){var n;N()(this,a),(n=s.call(this,e)).inputRef=(0,R.createRef)(),n.editMemberRef=R.createRef(),n.submit=function(){var e=n.state.config,t=e.user_type,s=e.users,a=e.roles,r=e.sign_method,i=void 0===r?2:r,l=e.leader_level,o=void 0===l?"1":l,c=e.root_level,d=void 0===c?"1":c,u=e.level_type,p=void 0===u?1:u,h=e.if_empty,m=void 0===h?1:h;if(s=s&&s.filter((function(e){return!e.leave})),t!==H.d||s&&0!=s.length)if(t!==H.MZ||a&&0!=a.length)if(t===H.MZ&&a.some((function(e){return e.is_empty})))F.ZP.warn("用户组为空，请添加用户组");else if(t===H.MZ&&a.some((function(e){return e.is_del})))F.ZP.warn("用户组为空，请添加用户组");else{var f={user_type:t};switch(t){case H.Dw:f.sign_method=i,f.level_num=o;break;case H.d:f.users=s,s.length>1&&(f.sign_method=i);break;case H.EN:f.level_type=p,f.sign_method=i,1==f.level_type?f.level_num=o:f.level_num=d;break;case H.MZ:f.sign_method=i,f.if_empty=m,f.roles=a.map((function(e){return{rid:e.role_id,rname:e.role_name}}))}n.state.approvalDrawerModel.node_value=g()(f),console.log("更新后的节点数据",n.state.approvalDrawerModel),n.props.onSubmit(n.state.approvalDrawerModel)}else F.ZP.warn("请选择指定用户组");else F.ZP.warn("请选择指定人员")},n.onRadioChange=function(e,t){n.state.config[t]=e.target.value,n.setState({config:n.state.config})},n.onCloseDrawer=function(){n.props.onCloseDrawer()},n.closeMember=function(){n.setState({memberSelectorVisible:!1})},n.showMemberSelector=function(){n.setState({memberSelectorVisible:!0}),n.editMemberRef.current.wrappedInstance.setCheck((n.state.config.users||[]).filter((function(e){return!e.leave})))},n.memberSelectorCallback=function(e){if(e.length>20)F.ZP.warn("最多可添加20个成员");else{var t=n.state.config;t.users=e.map((function(e){return{uid:e.id.toString(),uname:"string"==typeof e.name?e.name:e.name.props.children}})),n.setState({config:t,memberSelectorVisible:!1})}},n.onTitleChange=function(e){n.state.approvalDrawerModel.node_name=e.target.value,n.setState({approvalDrawerModel:n.state.approvalDrawerModel})},n.onSelectChange=function(e,t){n.state.config[t]=e,n.setState({config:n.state.config})},n.onTitleBlur=function(){n.setState({titleEditable:!1})},n.onTitleEdit=function(){n.setState({titleEditable:!0},(function(){n.inputRef.current.focus()}))},n.onDeleteMember=function(e){n.state.config.users.splice(e,1),n.setState({config:n.state.config})},n.onDeleteRole=function(e){n.state.config.roles.splice(e,1),n.setState({config:n.state.config})},n.showRoleSelector=function(){n.setState({roleSelectorVisible:!0})},n.onHideRolePicker=function(){n.setState({roleSelectorVisible:!1})},n.initData=function(){if(n.state.approvalDrawerModel.node_value){var e=JSON.parse(n.state.approvalDrawerModel.node_value);console.log("抽屉初始化数据",e),e.user_type===H.EN?1==e.level_type?e.leader_level=e.level_num:e.root_level=e.level_num:e.leader_level=e.level_num,e.user_type===H.MZ&&(e.roles=(e.roles||[]).map((function(e){return{role_id:e.rid,role_name:e.rname,is_empty:e.is_empty,is_del:e.is_del}}))),e.sign_method||(e.sign_method=2),n.setState({config:e})}};var t=(0,q.p$)(n.props.drawerData);return n.state={approvalDrawerModel:t,titleEditable:!1,memberSelectorVisible:!1,config:{},treeData:[],roleData:[],roleSelectorVisible:!1},n}return w()(a,[{key:"componentDidMount",value:function(){this.initData()}},{key:"render",value:function(){var e=this,n=this.state,t=n.approvalDrawerModel,s=n.titleEditable,a=n.config,r=(n.memberSelectorVisible,n.treeData,n.roleSelectorVisible,[]);return a.roles&&(r=a.roles.map((function(e){return z(z({},e),{},{key:e.role_id,title:e.role_name,uname:e.role_name})}))),(0,P.jsxs)("div",{style:{height:"100vh",position:"relative"},children:[(0,P.jsxs)("div",{className:"drawer-header",children:[(0,P.jsxs)(E.Z,{visible:!s,children:[(0,P.jsx)("span",{className:"edit-title",children:t.node_name}),(0,P.jsx)("span",{className:"edit-icon",onClick:this.onTitleEdit,style:{marginLeft:10}})]}),(0,P.jsx)(E.Z,{visible:s,children:(0,P.jsx)(B.Z,{maxLength:20,value:t.node_name,ref:this.inputRef,onChange:this.onTitleChange,onBlur:this.onTitleBlur,style:{width:300}})})]}),(0,P.jsxs)("div",{className:"drawer-content-wrapper",children:[(0,P.jsx)("h1",{className:"drawer-title",children:"设置审批人"}),(0,P.jsxs)(O.ZP.Group,{name:"radiogroup",className:"approval-type-radio-group",onChange:function(n){e.onRadioChange(n,"user_type")},value:a.user_type,children:[(0,P.jsx)(O.ZP,{className:"approval-type-radio",value:H.Dw,children:"指定主管"}),(0,P.jsx)(O.ZP,{className:"approval-type-radio",value:H.d,children:"指定成员"}),(0,P.jsxs)(O.ZP,{className:"approval-type-radio",value:H.EN,children:["连续多级主管",(0,P.jsx)(W.Z,{children:"发起人向上的各级主管依次审批"})]}),(0,P.jsxs)(O.ZP,{className:"approval-type-radio",value:H.MZ,children:["指定用户组",(0,P.jsx)(G.default,{})]})]}),(0,P.jsx)(E.Z,{visible:a.user_type==H.Dw,children:(0,P.jsxs)("div",{children:[(0,P.jsx)("span",{style:{marginRight:14},children:"发起人的"}),(0,P.jsx)(V.Z,{className:"approval-level-select",onChange:function(n){e.onSelectChange(n,"leader_level")},value:a.leader_level||"1",children:H.w9.map((function(e){return(0,P.jsx)(J,{value:e.value,children:e.label},e.value)}))})]})}),(0,P.jsxs)(E.Z,{visible:a.user_type==H.d,children:[(0,P.jsxs)("h1",{className:"drawer-title",children:["添加成员：",(0,P.jsx)("span",{className:"sub-title",children:"（不超过20个）"})]}),(0,P.jsx)(E.Z,{visible:a.users&&a.users.length>0,children:(0,P.jsx)(A.default,{showSelector:this.showMemberSelector,onDelete:this.onDeleteMember,members:a.users})}),(0,P.jsxs)(L.Z,{onClick:this.showMemberSelector,type:"primary",className:"drawer-add-member",children:[(0,P.jsx)(T.Z,{className:"drawer-add-member-icon"})," 添加指定成员"]})]}),(0,P.jsxs)(E.Z,{visible:a.user_type==H.MZ,children:[(0,P.jsxs)("h1",{className:"drawer-title",children:["添加用户组：",(0,P.jsx)("span",{className:"sub-title",children:"（单选）"})]}),(0,P.jsx)(E.Z,{visible:a.roles&&a.roles.length>0,children:(0,P.jsx)(A.default,{showSelector:this.showRoleSelector,onDelete:this.onDeleteRole,members:r})}),(0,P.jsxs)(L.Z,{onClick:this.showRoleSelector,type:"primary",className:"drawer-add-member",children:[(0,P.jsx)(T.Z,{className:"drawer-add-member-icon"})," 添加用户组"]})]}),(0,P.jsxs)(E.Z,{visible:a.user_type==H.EN,children:[(0,P.jsx)("h1",{className:"drawer-title",children:"根据申请人执行依次向上审批："}),(0,P.jsxs)(O.ZP.Group,{name:"approve",value:a.level_type||1,onChange:function(n){e.onRadioChange(n,"level_type")},children:[(0,P.jsxs)("div",{style:{marginBottom:16},children:[(0,P.jsx)(O.ZP,{value:1,children:(0,P.jsx)("span",{className:"text-split",children:"直到发起人向上的"})}),(0,P.jsx)(V.Z,{className:"approval-level-select",onChange:function(n){e.onSelectChange(n,"leader_level")},value:a.leader_level||"1",children:H.w9.map((function(e){return(0,P.jsx)(J,{value:e.value,children:e.label},e.value)}))})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)(O.ZP,{value:2,children:(0,P.jsx)("span",{className:"text-split",children:"直到通讯录中"})}),(0,P.jsx)(V.Z,{className:"approval-level-select",onChange:function(n){e.onSelectChange(n,"root_level")},value:a.root_level||"1",children:H.LI.map((function(e){return(0,P.jsx)(J,{value:e.value,children:e.label},e.value)}))})]})]})]}),(0,P.jsxs)(E.Z,{visible:H.EZ.includes(a.user_type)||a.user_type==H.d&&a.users&&a.users.length>1,children:[(0,P.jsx)("h1",{className:"drawer-title approval-type-title",children:"多人审批时采用的审批方式："}),(0,P.jsxs)(O.ZP.Group,{name:"radiogroup",onChange:function(n){e.onRadioChange(n,"sign_method")},value:a.sign_method||2,children:[(0,P.jsx)(O.ZP,{style:{marginBottom:10},value:2,children:"或签（一名审批人同意或拒绝即可）"}),(0,P.jsx)("br",{}),(0,P.jsx)(O.ZP,{value:1,children:"会签（须所有审批人同意）"})]})]}),(0,P.jsxs)(E.Z,{visible:a.user_type==H.MZ,children:[(0,P.jsx)("h1",{className:"drawer-title approval-type-title",children:"审批人为空时候："}),(0,P.jsxs)(O.ZP.Group,{name:"radiogroup",onChange:function(n){e.onRadioChange(n,"if_empty")},value:(0,q.xb)(a.if_empty)?1:a.if_empty,children:[(0,P.jsxs)(O.ZP,{style:{marginBottom:10},value:2,children:["自动通过",(0,P.jsx)(W.Z,{children:"当该用户组或主管没有人的时候，审批单将自动通过"})]}),(0,P.jsx)("br",{}),(0,P.jsxs)(O.ZP,{value:1,children:["自动转交管理员",(0,P.jsx)(W.Z,{children:"当用户组或主管为空时，审批单会自动转交给超级管理员"})]})]})]})]}),(0,P.jsxs)("div",{className:"button-bar",children:[(0,P.jsx)(L.Z,{type:"primary",onClick:function(){e.submit()},children:"确定"}),(0,P.jsx)(L.Z,{onClick:this.onCloseDrawer,children:"取消"})]})]})}}]),a}(R.Component)},73527:(e,n,t)=>{t.r(n),t.d(n,{default:()=>J});var s=t(58548),a=t.n(s),r=t(78829),i=t.n(r),l=t(51765),o=t.n(l),c=t(93287),d=t.n(c),u=t(24309),p=t.n(u),h=t(33929),m=t.n(h),f=t(63497),v=t.n(f),x=t(69984),j=t.n(x),b=t(74720),g=t.n(b),y=t(9830),N=t.n(y),_=t(30695),w=t.n(_),Z=t(83507),C=t.n(Z),S=t(69024),D=t.n(S),k=t(600),M=t.n(k),P=t(85893),R=t(67294),T=t(10438),E=t(58975),V=t(48086),F=t(14617),B=t(47933),O=t(9676),L=t(71577),q=t(49101),W=t(29713),A=t(43926),G=t(67741),H=t(7791);function I(e,n){var t=m()(e);if(p()){var s=p()(e);n&&(s=s.filter((function(n){return d()(e,n).enumerable}))),t.push.apply(t,s)}return t}function z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?I(Object(t),!0).forEach((function(n){j()(e,n,t[n])})):o()?i()(e,o()(t)):I(Object(t)).forEach((function(n){a()(e,n,d()(t,n))}))}return e}var J=function(e){C()(a,e);var n,t,s=(n=a,t=function(){if("undefined"==typeof Reflect||!v())return!1;if(v().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(v()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=M()(n);if(t){var a=M()(this).constructor;e=v()(s,arguments,a)}else e=s.apply(this,arguments);return D()(this,e)});function a(e){var n;return N()(this,a),(n=s.call(this,e)).inputRef=(0,R.createRef)(),n.editMemberRef=(0,R.createRef)(),n.submit=function(){var e=n.state.config,t=e.user_type,s=e.sign_method,a=void 0===s?2:s,r=e.roles,i=e.if_empty,l=void 0===i?1:i,o=n.state.users;if(o=o&&o.filter((function(e){return!e.leave})),3!==t||o&&0!=o.length)if(t!==H.MZ||r&&0!=r.length)if(t===H.MZ&&r.some((function(e){return e.is_empty})))V.ZP.warn("用户组为空，请添加用户组");else if(t===H.MZ&&r.some((function(e){return e.is_del})))V.ZP.warn("用户组为空，请添加用户组");else{var c={};switch(t){case 1:if(n.state.checkedList.length==n.state.financialMembers.length)c.user_type=1,c.sign_method=a;else{var d=n.state.financialMembers.filter((function(e){return n.state.checkedList.some((function(n){return n==e.uid&&!e.leave}))}));if(0==d.length)return void V.ZP.warn("请选择指定审单会计");1==d.length?c.sign_method=2:c.sign_method=a,c.users=d,c.user_type=2}break;case 3:c.users=o,c.user_type=3,1==o.length?c.sign_method=2:c.sign_method=a;break;case H.MZ:c.user_type=H.MZ,c.sign_method=a,c.if_empty=l,c.roles=r.map((function(e){return{rid:e.role_id,rname:e.role_name}}))}n.state.drawerModel.node_value=g()(c),console.log("更新后的节点数据",n.state.drawerModel),n.props.onSubmit(n.state.drawerModel)}else V.ZP.warn("请选择指定用户组");else V.ZP.warn("请选择指定人员")},n.onTitleBlur=function(){n.setState({titleEditable:!1})},n.onRadioChange=function(e,t){var s=n.state.checkedList;1==e.target.value&&"user_type"==t&&(s=n.state.financialMembers.map((function(e){return e.uid}))),n.state.config[t]=e.target.value,n.setState({config:n.state.config,checkedList:s})},n.onTitleEdit=function(){n.setState({titleEditable:!0},(function(){n.inputRef.current.focus()}))},n.onCloseDrawer=function(){n.props.onCloseDrawer()},n.onTitleChange=function(e){n.state.drawerModel.node_name=e.target.value,n.setState({drawerModel:n.state.drawerModel})},n.showMemberSelector=function(){n.setState({memberSelectorVisible:!0}),n.editMemberRef.current.wrappedInstance.setCheck((n.state.users||[]).filter((function(e){return!e.leave})))},n.onDeleteMember=function(e){n.state.users.splice(e,1),n.setState({users:n.state.users})},n.closeMember=function(){n.setState({memberSelectorVisible:!1})},n.onCheckboxGroupChange=function(e){n.setState({checkedList:e})},n.memberSelectorCallback=function(e){var t=n.state.users;e.length>20?V.ZP.warn("最多可添加20个成员"):(t=e.map((function(e){return{uid:e.id.toString(),uname:"string"==typeof e.name?e.name:e.name.props.children}})),n.setState({users:t,memberSelectorVisible:!1}))},n.onDeleteRole=function(e){n.state.config.roles.splice(e,1),n.setState({config:n.state.config})},n.showRoleSelector=function(){n.setState({roleSelectorVisible:!0})},n.onHideRolePicker=function(){n.setState({roleSelectorVisible:!1})},n.initData=function(){},n.state={drawerModel:(0,T.p$)(n.props.drawerData),titleEditable:!1,treeData:[],config:{},financialMembers:[],memberSelectorVisible:!1,checkedList:[],roleData:[],roleSelectorVisible:!1},n}return w()(a,[{key:"componentDidMount",value:function(){this.initData()}},{key:"render",value:function(){var e=this,n=this.state,t=n.titleEditable,s=n.drawerModel,a=n.config,r=n.financialMembers,i=(n.treeData,n.memberSelectorVisible,n.checkedList),l=n.users,o=(n.roleSelectorVisible,[]);return a.roles&&(o=a.roles.map((function(e){return z(z({},e),{},{key:e.role_id,title:e.role_name,uname:e.role_name})}))),(0,P.jsxs)("div",{style:{height:"100vh",position:"relative"},children:[(0,P.jsxs)("div",{className:"drawer-header",children:[(0,P.jsxs)(E.Z,{visible:!t,children:[(0,P.jsx)("span",{className:"edit-title",children:s.node_name}),(0,P.jsx)("span",{className:"edit-icon",onClick:this.onTitleEdit,style:{marginLeft:10}})]}),(0,P.jsx)(E.Z,{visible:t,children:(0,P.jsx)(F.Z,{maxLength:20,value:s.node_name,ref:this.inputRef,onChange:this.onTitleChange,onBlur:this.onTitleBlur,style:{width:300}})})]}),(0,P.jsxs)("div",{className:"drawer-content-wrapper",children:[(0,P.jsx)("h1",{className:"drawer-title",children:"设置审核人"}),(0,P.jsxs)(B.ZP.Group,{name:"radiogroup",className:"approval-type-radio-group",onChange:function(n){e.onRadioChange(n,"user_type")},value:a.user_type,children:[(0,P.jsx)(B.ZP,{className:"approval-type-radio",value:1,children:"全部审单会计"}),(0,P.jsx)(B.ZP,{className:"approval-type-radio",value:3,children:"指定成员"}),(0,P.jsxs)(B.ZP,{className:"approval-type-radio",value:H.MZ,children:["指定用户组",(0,P.jsx)(G.default,{})]})]}),(0,P.jsx)(E.Z,{visible:1==a.user_type&&r&&0==r.length,children:(0,P.jsxs)("div",{className:"setting-member-tips",children:[(0,P.jsx)("span",{className:"icon"}),(0,P.jsx)("span",{className:"text",children:"未设置财务权限人员，请先前往"}),(0,P.jsx)("span",{className:"highlight-text",children:"【企业设置-权限管理】"}),(0,P.jsx)("span",{className:"text",children:"中设置"})]})}),(0,P.jsx)(E.Z,{visible:1==a.user_type&&r&&r.length>0,children:(0,P.jsx)("div",{children:(0,P.jsx)(O.Z.Group,{onChange:this.onCheckboxGroupChange,defaultValue:i,children:r.map((function(e){return(0,P.jsx)(O.Z,{value:e.uid,className:e.leave?"quit":"",children:e.uname+(e.leave?"(已离职)":"")},e.uid)}))})})}),(0,P.jsxs)(E.Z,{visible:3==a.user_type,children:[(0,P.jsxs)("h1",{className:"drawer-title",children:["添加成员：",(0,P.jsx)("span",{className:"sub-title",children:"（不超过20个）"})]}),(0,P.jsx)(E.Z,{visible:l&&l.length>0,children:(0,P.jsx)(A.default,{showSelector:this.showMemberSelector,onDelete:this.onDeleteMember,members:l})}),(0,P.jsxs)(L.Z,{onClick:this.showMemberSelector,type:"primary",className:"drawer-add-member",children:[(0,P.jsx)(q.Z,{className:"drawer-add-member-icon"})," 添加指定成员"]})]}),(0,P.jsxs)(E.Z,{visible:a.user_type==H.MZ,children:[(0,P.jsxs)("h1",{className:"drawer-title",children:["添加用户组：",(0,P.jsx)("span",{className:"sub-title",children:"（单选）"})]}),(0,P.jsx)(E.Z,{visible:a.roles&&a.roles.length>0,children:(0,P.jsx)(A.default,{showSelector:this.showRoleSelector,onDelete:this.onDeleteRole,members:o})}),(0,P.jsxs)(L.Z,{onClick:this.showRoleSelector,type:"primary",className:"drawer-add-member",children:[(0,P.jsx)(q.Z,{className:"drawer-add-member-icon"})," 添加用户组"]})]}),(0,P.jsxs)(E.Z,{visible:a.user_type===H.MZ||1==a.user_type&&i.length>1||3==a.user_type&&l&&l.length>1,children:[(0,P.jsx)("h1",{className:"drawer-title approval-type-title",children:"多人审批时采用的审批方式"}),(0,P.jsxs)(B.ZP.Group,{name:"radiogroup",onChange:function(n){e.onRadioChange(n,"sign_method")},value:a.sign_method||2,children:[(0,P.jsx)(B.ZP,{style:{marginBottom:10},value:2,children:"或签（一名审批人同意或拒绝即可）"}),(0,P.jsx)("br",{}),(0,P.jsx)(B.ZP,{value:1,children:"会签（须所有审批人同意）"})]})]}),(0,P.jsxs)(E.Z,{visible:a.user_type==H.MZ,children:[(0,P.jsx)("h1",{className:"drawer-title approval-type-title",children:"审批人为空时候："}),(0,P.jsxs)(B.ZP.Group,{name:"radiogroup",onChange:function(n){e.onRadioChange(n,"if_empty")},value:(0,T.xb)(a.if_empty)?1:a.if_empty,children:[(0,P.jsxs)(B.ZP,{style:{marginBottom:10},value:2,children:["自动通过",(0,P.jsx)(W.Z,{children:"当该用户组或主管没有人的时候，审批单将自动通过"})]}),(0,P.jsx)("br",{}),(0,P.jsxs)(B.ZP,{value:1,children:["自动转交管理员",(0,P.jsx)(W.Z,{children:"当用户组或主管为空时，审批单会自动转交给超级管理员"})]})]})]})]}),(0,P.jsxs)("div",{className:"button-bar",children:[(0,P.jsx)(L.Z,{type:"primary",onClick:function(){e.submit()},children:"确定"}),(0,P.jsx)(L.Z,{onClick:this.onCloseDrawer,children:"取消"})]})]})}}]),a}(R.Component)},43926:(e,n,t)=>{t.r(n),t.d(n,{default:()=>N});var s,a,r=t(63497),i=t.n(r),l=t(9830),o=t.n(l),c=t(30695),d=t.n(c),u=t(83507),p=t.n(u),h=t(69024),m=t.n(h),f=t(600),v=t.n(f),x=t(85893),j=t(67294),b=t(57016),g=t(71577),y=t(31097);var N=(0,t(16550).EN)((a=function(e){p()(a,e);var n,t,s=(n=a,t=function(){if("undefined"==typeof Reflect||!i())return!1;if(i().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(i()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=v()(n);if(t){var a=v()(this).constructor;e=i()(s,arguments,a)}else e=s.apply(this,arguments);return m()(this,e)});function a(){var e;o()(this,a);for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return(e=s.call.apply(s,[this].concat(t))).onDelete=function(n,t){n&&n.stopPropagation(),e.props.onDelete(t)},e.linkRolePage=function(n){n.preventDefault(),n.stopPropagation(),b.Z.confirm({title:"提示",content:"设置用户组不会保存当前审批流，确认要去设置用户组吗",cancelText:"取消",okText:"去设置",zIndex:2e3,onOk:function(){e.props.history.replace("/company/roles/index")}})},e.generateMemberEl=function(n,t){if(n.is_empty){var s=(0,x.jsxs)("div",{children:["该用户组下没有成员,",(0,x.jsx)(g.Z,{style:{padding:0},type:"link",onClick:e.linkRolePage,children:"前往设置"})]});return(0,x.jsx)(y.Z,{placement:"top",title:s,children:(0,x.jsxs)("div",{className:"member-box quit",children:[(0,x.jsx)("span",{className:"img-box",children:n.uname.substr(0,1)}),(0,x.jsx)("span",{className:"member-name",children:"".concat(n.uname).concat(n.leave?"(已离职)":"").concat(n.is_del?"(已删除)":"")}),(0,x.jsx)("span",{className:"member-tip-icon",children:(0,x.jsx)("img",{src:"https://apg-1258944054.cos.ap-guangzhou.myqcloud.com/apg/pc-micro-reimburse/common/%21.png",alt:""})}),(0,x.jsx)("i",{className:"member-delete",onClick:function(n){e.onDelete(n,t)}})]})},t)}return(0,x.jsxs)("div",{className:"member-box ".concat(n.leave||n.is_del?"quit":""),children:[(0,x.jsx)("span",{className:"img-box",children:n.uname.substr(0,1)}),(0,x.jsx)("span",{className:"member-name",children:"".concat(n.uname).concat(n.leave?"(已离职)":"").concat(n.is_del?"(已删除)":"")}),(0,x.jsx)("i",{className:"member-delete",onClick:function(n){e.onDelete(n,t)}})]},t)},e}return d()(a,[{key:"render",value:function(){var e=this,n=this.props.members;return(0,x.jsx)("div",{className:"selected-member-wrapper",onClick:function(){e.props.showSelector&&e.props.showSelector()},children:n.map((function(n,t){return e.generateMemberEl(n,t)}))})}}]),a}(j.Component),s=a))||s},72551:(e,n,t)=>{t.r(n),t.d(n,{default:()=>k});var s=t(63497),a=t.n(s),r=t(74720),i=t.n(r),l=t(9830),o=t.n(l),c=t(30695),d=t.n(c),u=t(83507),p=t.n(u),h=t(69024),m=t.n(h),f=t(600),v=t.n(f),x=t(85893),j=t(67294),b=t(10438),g=t(58975),y=t(34041),N=t(48086),_=t(14617),w=t(71577),Z=t(43926),C=t(49101),S=t(7791);var D=y.Z.Option,k=function(e){p()(r,e);var n,t,s=(n=r,t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(a()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=v()(n);if(t){var r=v()(this).constructor;e=a()(s,arguments,r)}else e=s.apply(this,arguments);return m()(this,e)});function r(e){var n;return o()(this,r),(n=s.call(this,e)).inputRef=(0,j.createRef)(),n.editMemberRef=(0,j.createRef)(),n.submit=function(){var e=n.state.config,t=e.cc_superiors,s=e.users;if(s=s.filter((function(e){return!e.leave})),t&&0!=t.length||s&&0!=s.length){var a={};s&&s.length>0&&(a.users=s),t&&t.length>0&&(a.level_num=t.map((function(e){return e.level_num})).join(",")),n.state.drawerModel.node_value=i()(a),console.log("更新后的节点数据",n.state.drawerModel),n.props.onSubmit(n.state.drawerModel)}else N.ZP.warn("请选择指定成员或者添加指定上级")},n.onTitleBlur=function(){n.setState({titleEditable:!1})},n.onTitleEdit=function(){n.setState({titleEditable:!0},(function(){n.inputRef.current.focus()}))},n.onCloseDrawer=function(){n.props.onCloseDrawer()},n.closeMember=function(){n.setState({memberSelectorVisible:!1})},n.memberSelectorCallback=function(e){var t=n.state.config;e.length>20?N.ZP.warn("最多可添加20个成员"):(t.users=e.map((function(e){return{type:e.type,uid:e.id.toString(),uname:"string"==typeof e.name?e.name:e.name.props.children}})),n.setState({config:t,memberSelectorVisible:!1}))},n.onTitleChange=function(e){n.state.drawerModel.node_name=e.target.value,n.setState({drawerModel:n.state.drawerModel})},n.showMemberSelector=function(){n.setState({memberSelectorVisible:!0}),n.editMemberRef.current.wrappedInstance.setCheck((n.state.config.users||[]).filter((function(e){return!e.leave})))},n.addSuperior=function(){var e=n.state.config.cc_superiors,t=void 0===e?[]:e;t.push({level_num:"1"}),n.state.config.cc_superiors=t,n.setState({config:n.state.config})},n.onSuperiorTypeChange=function(e,t){var s=n.state.config.cc_superiors,a=void 0===s?[]:s;a[t].level_num=e,n.state.config.cc_superiors=a,n.setState({config:n.state.config})},n.deleteCondition=function(e){var t=n.state.config.cc_superiors,s=void 0===t?[]:t;s.splice(e,1),n.state.config.cc_superiors=s,n.setState({config:n.state.config})},n.onDeleteMember=function(e){n.state.config.users.splice(e,1),n.setState({config:n.state.config})},n.initData=function(){if(n.state.drawerModel.node_value){var e=JSON.parse(n.state.drawerModel.node_value);if(console.log("初始化抽屉数据",e),e.level_num){var t=e.level_num.split(","),s=[];t.forEach((function(e){s.push({level_num:e})})),e.cc_superiors=s}n.setState({config:e})}},n.state={drawerModel:(0,b.p$)(n.props.drawerData),titleEditable:!1,treeData:[],config:{}},n}return d()(r,[{key:"componentDidMount",value:function(){this.initData()}},{key:"render",value:function(){var e=this,n=this.state,t=n.titleEditable,s=n.drawerModel,a=(n.treeData,n.memberSelectorVisible,n.config);return(0,x.jsxs)("div",{style:{height:"100vh",position:"relative"},children:[(0,x.jsxs)("div",{className:"drawer-header",children:[(0,x.jsxs)(g.Z,{visible:!t,children:[(0,x.jsx)("span",{className:"edit-title",children:s.node_name}),(0,x.jsx)("span",{className:"edit-icon",onClick:this.onTitleEdit,style:{marginLeft:10}})]}),(0,x.jsx)(g.Z,{visible:t,children:(0,x.jsx)(_.Z,{maxLength:20,value:s.node_name,ref:this.inputRef,onChange:this.onTitleChange,onBlur:this.onTitleBlur,style:{width:300}})})]}),(0,x.jsxs)("div",{className:"drawer-content-wrapper",children:[(0,x.jsxs)("h1",{className:"drawer-title",children:["指定成员：",(0,x.jsx)("span",{className:"sub-title",children:"（可抄送成员）"})]}),(0,x.jsx)(g.Z,{visible:a.users&&a.users.length>0,children:(0,x.jsx)(Z.default,{showSelector:this.showMemberSelector,onDelete:this.onDeleteMember,members:a.users})}),(0,x.jsxs)(w.Z,{onClick:this.showMemberSelector,type:"primary",className:"drawer-add-notify-member",children:[(0,x.jsx)(C.Z,{className:"drawer-add-member-icon"})," 添加"]}),(0,x.jsxs)("h1",{className:"drawer-title",children:["指定上级：",(0,x.jsx)("span",{className:"sub-title",children:"（可抄送指定层级上单）"})]}),a.cc_superiors&&a.cc_superiors.map((function(n,t){return(0,x.jsxs)("div",{className:"notify-drawer-appoint-superiors",children:[(0,x.jsx)(y.Z,{value:n.level_num||"1",onChange:function(n){e.onSuperiorTypeChange(n,t)},children:S.w9.map((function(e){return(0,x.jsx)(D,{value:e.value,children:e.label},e.value)}))}),(0,x.jsx)("span",{className:"condition-edit-close",onClick:function(){e.deleteCondition(t)}})]},t)})),(0,x.jsxs)(w.Z,{onClick:this.addSuperior,type:"primary",className:"drawer-add-notify-condition",children:[(0,x.jsx)(C.Z,{})," 添加上级"]})]}),(0,x.jsxs)("div",{className:"button-bar",children:[(0,x.jsx)(w.Z,{type:"primary",onClick:function(){e.submit()},children:"确定"}),(0,x.jsx)(w.Z,{onClick:this.onCloseDrawer,children:"取消"})]})]})}}]),r}(j.Component)},3710:(e,n,t)=>{t.r(n),t.d(n,{default:()=>J});var s=t(58548),a=t.n(s),r=t(78829),i=t.n(r),l=t(51765),o=t.n(l),c=t(93287),d=t.n(c),u=t(24309),p=t.n(u),h=t(33929),m=t.n(h),f=t(63497),v=t.n(f),x=t(69984),j=t.n(x),b=t(74720),g=t.n(b),y=t(9830),N=t.n(y),_=t(30695),w=t.n(_),Z=t(83507),C=t.n(Z),S=t(69024),D=t.n(S),k=t(600),M=t.n(k),P=t(85893),R=t(67294),T=t(10438),E=t(58975),V=t(48086),F=t(14617),B=t(47933),O=t(9676),L=t(71577),q=t(49101),W=t(29713),A=t(67741),G=t(43926),H=t(7791);function I(e,n){var t=m()(e);if(p()){var s=p()(e);n&&(s=s.filter((function(n){return d()(e,n).enumerable}))),t.push.apply(t,s)}return t}function z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?I(Object(t),!0).forEach((function(n){j()(e,n,t[n])})):o()?i()(e,o()(t)):I(Object(t)).forEach((function(n){a()(e,n,d()(t,n))}))}return e}var J=function(e){C()(a,e);var n,t,s=(n=a,t=function(){if("undefined"==typeof Reflect||!v())return!1;if(v().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(v()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=M()(n);if(t){var a=M()(this).constructor;e=v()(s,arguments,a)}else e=s.apply(this,arguments);return D()(this,e)});function a(e){var n;return N()(this,a),(n=s.call(this,e)).inputRef=(0,R.createRef)(),n.editMemberRef=(0,R.createRef)(),n.submit=function(){var e=n.state.config,t=e.user_type,s=e.roles,a=e.if_empty,r=n.state.users;if(r=r&&r.filter((function(e){return!e.leave})),3!==t||r&&0!=r.length)if(t!==H.MZ||s&&0!=s.length)if(t===H.MZ&&s.some((function(e){return e.is_empty})))V.ZP.warn("用户组为空，请添加用户组");else if(t===H.MZ&&s.some((function(e){return e.is_del})))V.ZP.warn("用户组为空，请添加用户组");else{var i={};switch(t){case 1:if(n.state.checkedList.length==n.state.paymentMembers.length)i.users=null,i.user_type=1;else{var l=n.state.paymentMembers.filter((function(e){return n.state.checkedList.some((function(n){return n==e.uid&&!e.leave}))}));if(0==l.length)return void V.ZP.warn("请选择指定审核人");i.users=l,i.user_type=2}break;case 3:i.users=r,i.user_type=3;break;case H.MZ:i.user_type=H.MZ,i.if_empty=a,i.roles=s.map((function(e){return{rid:e.role_id,rname:e.role_name}}))}i.pay_status=n.state.config.pay_status,n.state.drawerModel.node_value=g()(i),console.log("更新后的节点数据",n.state.drawerModel),n.props.onSubmit(n.state.drawerModel)}else V.ZP.warn("请选择指定用户组");else V.ZP.warn("请选择指定人员")},n.onTitleBlur=function(){n.setState({titleEditable:!1})},n.onRadioChange=function(e,t){var s=[];1==e.target.value&&(s=n.state.paymentMembers.map((function(e){return e.uid}))),n.state.config[t]=e.target.value,n.setState({config:n.state.config,checkedList:s})},n.onTitleEdit=function(){n.setState({titleEditable:!0},(function(){n.inputRef.current.focus()}))},n.onCloseDrawer=function(){n.props.onCloseDrawer()},n.onTitleChange=function(e){n.state.drawerModel.node_name=e.target.value,n.setState({drawerModel:n.state.drawerModel})},n.showMemberSelector=function(){n.setState({memberSelectorVisible:!0}),n.editMemberRef.current.wrappedInstance.setCheck((n.state.users||[]).filter((function(e){return!e.leave})))},n.onDeleteMember=function(e){n.state.users.splice(e,1),n.setState({users:n.state.users})},n.closeMember=function(){n.setState({memberSelectorVisible:!1})},n.onCheckboxGroupChange=function(e){n.setState({checkedList:e})},n.memberSelectorCallback=function(e){var t=n.state.users;e.length>20?V.ZP.warn("最多可添加20个成员"):(t=e.map((function(e){return{uid:e.id.toString(),uname:"string"==typeof e.name?e.name:e.name.props.children}})),n.setState({users:t,memberSelectorVisible:!1}))},n.onDeleteRole=function(e){n.state.config.roles.splice(e,1),n.setState({config:n.state.config})},n.showRoleSelector=function(){n.setState({roleSelectorVisible:!0})},n.onHideRolePicker=function(){n.setState({roleSelectorVisible:!1})},n.initData=function(){},n.state={drawerModel:(0,T.p$)(n.props.drawerData),titleEditable:!1,config:{},paymentMembers:[],treeData:[],memberSelectorVisible:!1,checkedList:[],users:[],roleData:[],roleSelectorVisible:!1},n}return w()(a,[{key:"componentDidMount",value:function(){this.initData()}},{key:"render",value:function(){var e=this,n=this.state,t=n.titleEditable,s=n.drawerModel,a=n.config,r=n.paymentMembers,i=(n.treeData,n.memberSelectorVisible,n.checkedList),l=n.users,o=(n.roleSelectorVisible,[]);return a.roles&&(o=a.roles.map((function(e){return z(z({},e),{},{key:e.role_id,title:e.role_name,uname:e.role_name})}))),(0,P.jsxs)("div",{style:{height:"100vh",position:"relative"},children:[(0,P.jsxs)("div",{className:"drawer-header",children:[(0,P.jsxs)(E.Z,{visible:!t,children:[(0,P.jsx)("span",{className:"edit-title",children:s.node_name}),(0,P.jsx)("span",{className:"edit-icon",onClick:this.onTitleEdit,style:{marginLeft:10}})]}),(0,P.jsx)(E.Z,{visible:t,children:(0,P.jsx)(F.Z,{maxLength:20,value:s.node_name,ref:this.inputRef,onChange:this.onTitleChange,onBlur:this.onTitleBlur,style:{width:300}})})]}),(0,P.jsxs)("div",{className:"drawer-content-wrapper",children:[(0,P.jsx)("h1",{className:"drawer-title",children:"设置审核人"}),(0,P.jsxs)(B.ZP.Group,{name:"radiogroup",className:"approval-type-radio-group",onChange:function(n){e.onRadioChange(n,"user_type")},value:a.user_type,children:[(0,P.jsx)(B.ZP,{className:"approval-type-radio",value:1,children:"全部出纳人员"}),(0,P.jsx)(B.ZP,{className:"approval-type-radio",value:3,children:"指定成员"}),(0,P.jsxs)(B.ZP,{className:"approval-type-radio",value:H.MZ,children:["指定用户组",(0,P.jsx)(A.default,{})]})]}),(0,P.jsx)(E.Z,{visible:1==a.user_type&&r&&0==r.length,children:(0,P.jsxs)("div",{className:"setting-member-tips",children:[(0,P.jsx)("span",{className:"icon"}),(0,P.jsx)("span",{className:"text",children:"未设置出纳权限人员，请先前往"}),(0,P.jsx)("span",{className:"highlight-text",children:"【企业设置-权限管理】"}),(0,P.jsx)("span",{className:"text",children:"中设置"})]})}),(0,P.jsx)(E.Z,{visible:1==a.user_type&&r&&r.length>0,children:(0,P.jsx)("div",{children:(0,P.jsx)(O.Z.Group,{onChange:this.onCheckboxGroupChange,value:i,children:r.map((function(e){return(0,P.jsx)(O.Z,{value:e.uid,className:e.leave?"quit":"",children:e.uname+(e.leave?"(已离职)":"")},e.uid)}))})})}),(0,P.jsxs)(E.Z,{visible:3==a.user_type,children:[(0,P.jsxs)("h1",{className:"drawer-title",children:["添加成员：",(0,P.jsx)("span",{className:"sub-title",children:"（不超过20个）"})]}),(0,P.jsx)(E.Z,{visible:l&&l.length>0,children:(0,P.jsx)(G.default,{showSelector:this.showMemberSelector,onDelete:this.onDeleteMember,members:l})}),(0,P.jsxs)(L.Z,{onClick:this.showMemberSelector,type:"primary",className:"drawer-add-member",children:[(0,P.jsx)(q.Z,{className:"drawer-add-member-icon"})," 添加指定成员"]})]}),(0,P.jsxs)(E.Z,{visible:a.user_type==H.MZ,children:[(0,P.jsxs)("h1",{className:"drawer-title",children:["添加用户组：",(0,P.jsx)("span",{className:"sub-title",children:"（单选）"})]}),(0,P.jsx)(E.Z,{visible:a.roles&&a.roles.length>0,children:(0,P.jsx)(G.default,{showSelector:this.showRoleSelector,onDelete:this.onDeleteRole,members:o})}),(0,P.jsxs)(L.Z,{onClick:this.showRoleSelector,type:"primary",className:"drawer-add-member",children:[(0,P.jsx)(q.Z,{className:"drawer-add-member-icon"})," 添加用户组"]})]}),(0,P.jsxs)(E.Z,{visible:a.user_type==H.MZ,children:[(0,P.jsx)("h1",{className:"drawer-title approval-type-title",children:"审批人为空时候："}),(0,P.jsx)(B.ZP.Group,{name:"radiogroup",onChange:function(n){e.onRadioChange(n,"if_empty")},value:(0,T.xb)(a.if_empty)?1:a.if_empty,children:(0,P.jsxs)(B.ZP,{value:1,children:["自动转交管理员",(0,P.jsx)(W.Z,{children:"当用户组或主管为空时，审批单会自动转交给超级管理员"})]})})]})]}),(0,P.jsxs)("div",{className:"button-bar",children:[(0,P.jsx)(L.Z,{type:"primary",onClick:function(){e.submit()},children:"确定"}),(0,P.jsx)(L.Z,{onClick:this.onCloseDrawer,children:"取消"})]})]})}}]),a}(R.Component)},67741:(e,n,t)=>{t.r(n),t.d(n,{default:()=>G});var s=t(63497),a=t.n(s),r=t(9830),i=t.n(r),l=t(30695),o=t.n(l),c=t(83507),d=t.n(c),u=t(69024),p=t.n(u),h=t(600),m=t.n(h),f=t(85893),v=t(67294),x=t(57016),j=t(71577),b=t(16550),g=t(58548),y=t.n(g),N=t(78829),_=t.n(N),w=t(51765),Z=t.n(w),C=t(93287),S=t.n(C),D=t(24309),k=t.n(D),M=t(33929),P=t.n(M),R=t(69984),T=t.n(R),E=t(11845),V=t.n(E),F=t(19181),B=t(80411),O=t.n(B);function L(e,n){var t=P()(e);if(k()){var s=k()(e);n&&(s=s.filter((function(n){return S()(e,n).enumerable}))),t.push.apply(t,s)}return t}function q(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?L(Object(t),!0).forEach((function(n){T()(e,n,t[n])})):Z()?_()(e,Z()(t)):L(Object(t)).forEach((function(n){y()(e,n,S()(t,n))}))}return e}var W,A=function(e){d()(r,e);var n,t,s=(n=r,t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(a()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=m()(n);if(t){var r=m()(this).constructor;e=a()(s,arguments,r)}else e=s.apply(this,arguments);return p()(this,e)});function r(){return i()(this,r),s.apply(this,arguments)}return o()(r,[{key:"render",value:function(){var e=this.props,n=(e.content,e.minHgWid),t=void 0===n?20:n,s=e.children,a=e.bgOpacity,r=void 0!==a&&a,i=V()(e,["content","minHgWid","children","bgOpacity"]),l=(0,f.jsx)("div",{className:"hover-tips-content",children:s});return(0,f.jsx)(F.Z,q(q({content:l,className:"hover-tips-popover"},i),{},{children:(0,f.jsx)("div",{id:"hover-popover",className:O()({"bg-opacity":r}),style:{minHeight:t,minWidth:t}})}))}}]),r}(v.Component);const G=(0,b.EN)(W=function(e){d()(r,e);var n,t,s=(n=r,t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(a()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=m()(n);if(t){var r=m()(this).constructor;e=a()(s,arguments,r)}else e=s.apply(this,arguments);return p()(this,e)});function r(){var e;i()(this,r);for(var n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];return(e=s.call.apply(s,[this].concat(t))).linkRolePage=function(){x.Z.confirm({title:"提示",content:"设置用户组不会保存当前审批流，确认要去设置用户组吗",cancelText:"取消",okText:"去设置",zIndex:2e3,onOk:function(){e.props.history.replace("/company/roles/index")}})},e}return o()(r,[{key:"render",value:function(){return(0,f.jsx)(A,{placement:"bottomRight",children:(0,f.jsxs)("div",{className:"role-popover-container",children:[(0,f.jsx)("h1",{className:"role-popover-title",children:"适用场景："}),(0,f.jsx)("img",{className:"role-desc-img",src:"https://apg-1258944054.cos.ap-guangzhou.myqcloud.com/apg/pc-micro-reimburse/apply-flow/role_popover.png",alt:""}),(0,f.jsx)("h1",{className:"role-popover-title",children:"用户组定义："}),(0,f.jsx)("p",{className:"role-popover-content",children:"将很多有相同审批职能的人设置为同一用户组，并将这个用户组添加为审批人，如部门总监"}),(0,f.jsx)("h1",{className:"role-popover-title",children:"用户组的管理范围："}),(0,f.jsx)("p",{className:"role-popover-content",children:"可以给用户组里的每成员指定管理的部门，这些部门的员工提交的单据就由该成员审批，默认管理所有人。"}),(0,f.jsx)("h1",{className:"role-popover-title",children:"如何设置："}),(0,f.jsxs)("div",{className:"role-popover-steps",children:[(0,f.jsxs)("div",{className:"role-popover-step",children:[(0,f.jsx)("span",{className:"icon",children:"1"}),(0,f.jsx)("span",{className:"desc",children:"进入组织架构设置用户组"}),(0,f.jsx)("span",{className:"arrow",children:(0,f.jsx)("img",{src:"https://apg-1258944054.cos.ap-guangzhou.myqcloud.com/apg/pc-micro-reimburse/apply-flow/role-popover-arrow.png",alt:""})})]}),(0,f.jsxs)("div",{className:"role-popover-step",children:[(0,f.jsx)("span",{className:"icon",children:"2"}),(0,f.jsx)("span",{className:"desc",children:"设置用户组的管理范围"}),(0,f.jsx)("span",{className:"arrow",children:(0,f.jsx)("img",{src:"https://apg-1258944054.cos.ap-guangzhou.myqcloud.com/apg/pc-micro-reimburse/apply-flow/role-popover-arrow.png",alt:""})})]}),(0,f.jsxs)("div",{className:"role-popover-step",children:[(0,f.jsx)("span",{className:"icon",children:"3"}),(0,f.jsx)("span",{className:"desc",children:"审批流里使用用户组"})]})]}),(0,f.jsx)(j.Z,{className:"set-role-btn",onClick:this.linkRolePage,children:"设置用户组"})]})})}}]),r}(v.Component))||W},3385:(e,n,t)=>{t.r(n),t.d(n,{default:()=>le});var s=t(63497),a=t.n(s),r=t(23010),i=t.n(r),l=t(74720),o=t.n(l),c=t(48550),d=t.n(c),u=t(9830),p=t.n(u),h=t(30695),m=t.n(h),f=t(83507),v=t.n(f),x=t(69024),j=t.n(x),b=t(600),g=t.n(b),y=t(85893),N=t(67294),_=t(80411),w=t.n(_),Z=t(58975),C=t(48086),S=t(19181),D=t(59314),k=t(31097),M=t(57016),P=t(14617),R=t(71577),T=t(83107),E=t(54549),V=t(7791),F=t(10438),B=(0,F.qW)(V.zH),O=(0,F.qW)(V.ve),L=(0,F.qW)(V.J_),q=(0,F.qW)(V.S_),W=(0,F.qW)(V.w9),A=(0,F.qW)(V.LI),G=function(e){e=e||32;for(var n="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",t=n.length,s="",a=0;a<e;a++)s+=n.charAt(Math.floor(Math.random()*t));return s},H=function e(n){for(var t=0;t<n.length;){var s=n[t],a=s.lineNodes;s.node_type===V.KT&&a&&a.length>0?(a.forEach((function(e,n){n<9&&e.node_option&&(e.node_option.includes("0")||(e.node_option="优先级0".concat(n+1))),e.node_seq=t})),n.splice.apply(n,[t,1].concat(i()(e(a))))):s.node_type!=V.dA&&(s.node_seq=t),s.child_nodes&&s.child_nodes.length>0&&e(s.child_nodes),t++}return n},I=function(e){e.forEach((function(e,n){e.node_option="优先级".concat(n+1)}))},z=function(e){var n=[];return function e(t){var s=t.some((function(e){return e.node_type==V.ux})),a=t.some((function(e){return e.node_type==V.Oh})),r=t.some((function(e){return e.node_type==V.PC})),i=t.findIndex((function(e){return e.node_type==V.KT}));s&&n.push(V.ux),a&&n.push(V.Oh),r&&n.push(V.PC),i>=0&&t[i].lineNodes.forEach((function(n){e(n.child_nodes)}))}(e),n},J=function e(n){var t=!1;return n.some((function(n){return n.node_type===V.KT?(n.lineNodes.forEach((function(n){t=e(n.child_nodes)})),t):n.node_type===V.PC}))},Q=function(e){var n=!1;return e.findIndex((function(e){return e.node_type===V.KT?(e.lineNodes.forEach((function(e){n=J(e.child_nodes)})),n):e.node_type===V.PC}))},K=t(93971),$=t(93563),Y=t(73527),U=t(3710),X=t(72551),ee=t(67724),ne=t(80129),te=t.n(ne);function se(e,n,t,s){var a,r=0;function i(){var i=this,l=Number(new Date)-r,o=arguments;function c(){r=Number(new Date),t.apply(i,o)}function d(){a=void 0}s&&!a&&c(),a&&clearTimeout(a),void 0===s&&l>e?c():!0!==n&&(a=setTimeout(s?d:c,void 0===s?e-l:e))}return"boolean"!=typeof n&&(s=t,t=n,n=void 0),i.cancel=function(){clearTimeout(a)},i}var ae={},re={},ie=function(e,n,t){if(""===e||null==e)return"";var s=n.find((function(n){return n.value==e&&n.template_types.includes(Number(t))}));return s?s.label:e},le=function(e){v()(r,e);var n,t,s=(n=r,t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(a()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=g()(n);if(t){var r=g()(this).constructor;e=a()(s,arguments,r)}else e=s.apply(this,arguments);return j()(this,e)});function r(e){var n,t;return p()(this,r),(n=s.call(this,e)).tempTitleRef=(0,N.createRef)(),n.initData=function(){var e,t,s=te().parse(location.search,{ignoreQueryPrefix:!0}),a=s.template_name,r=void 0===a?"":a,i=(s.template_id,s.template_type),l=s.doc_tmpl_type;t=1==(e=2==+l?1:2)?[{node_type:V.WD,key:G()},(0,V.yl)(2),{node_type:V.xV,key:G()}]:[{node_type:V.WD,key:G()},(0,V.yl)(2),(0,V.du)(),(0,V.ok)(),{node_type:V.xV,key:G()}],n.setState({approvalFlowData:t,template_name:decodeURIComponent(r),template_type:i,doc_tmpl_type:l,template:e})},n.onSaveTemp=function(){n.setState({submitLoading:!0});var e=function(e){var t=e.node_value&&JSON.parse(e.node_value)||{};if(t.users&&n.haddleQuit(t.users))return!1;if(t.roles&&n.haddleRoleStatus(t.roles))return!1;if(e.node_type===V.ux&&3==t.user_type&&(!t.users||0==t.users.length))return!1;if(!(e.node_type!==V.Oh&&e.node_type!==V.PC||3!=t.user_type||t.users&&0!=t.users.length))return!1;if(e.node_type===V.dA){if(!(t.conditions&&0!=t.conditions.length||e.default))return!1;for(var s=t.conditions,a=void 0===s?[]:s,r=!0,i=0;i<a.length;i++)if(a[i].type===V.Bv)for(var l=a[i].value.split(","),o=0;o<l.length;o++){var c=l[o].split("#"),u=d()(c,3);if(u[0],u[1],"true"===u[2]){r=!1;break}}if(!r)return r}return!!(e.node_type!==V.k0||t.users&&0!=t.users.length||t.level_num)},t=H((0,F.p$)(n.state.approvalFlowData));if(!function n(t){for(var s=!0,a=0;a<t.length&&(s=e(t[a]))&&(t[a].node_type==V.dA&&(s=n(t[a].child_nodes)),s);a++);return s}(t))return n.setState({submitLoading:!1}),void C.ZP.warn("存在节点信息配置不完整，详见流程图警告提示");n.state.template_id,n.state.template_name,n.state.template_type,t.slice(1,-1),C.ZP.success("保存成功"),n.goBack()},n.generateNodeContainer=function(e){return e&&e.map((function(t,s){switch(t.node_type){case V.WD:case V.xV:return n.generateApplicantNode(t,s,e);case V.Oh:return n.generateFinancialNode(t,s,e);case V.PC:return n.generatePaymentNode(t,s,e);case V.ux:return n.generateApprovalNode(t,s,e);case V.k0:return n.generateNotifyNode(t,s,e);case V.KT:return n.generateRouteNode(t,s,e)}}))},n.generateApplicantNode=function(e,t,s){return(0,y.jsxs)("div",{className:"node-container",children:[(0,y.jsx)("div",{children:(0,y.jsxs)("div",{className:"node-box-start",children:[(0,y.jsx)(Z.Z,{visible:e.node_type!=V.xV,children:(0,y.jsx)("div",{className:"content",children:"开始"})}),(0,y.jsx)(Z.Z,{visible:e.node_type==V.xV,children:(0,y.jsx)("div",{className:"content",children:"结束"})})]})}),(0,y.jsx)(Z.Z,{visible:e.node_type!=V.xV,children:(0,y.jsx)("div",{className:"add-node-btn-box",children:(0,y.jsx)("div",{className:"add-node-btn",children:(0,y.jsx)(S.Z,{placement:"right",content:n.generateCreateNodeBtns(e.node_type,t,s),children:(0,y.jsx)("div",{className:"btn"})})})})})]},e.key)},n.generateSelectorNode=function(e,t,s,a){var r,i={};return e.node_value&&(r=JSON.parse(e.node_value).conditions),r&&(i=n.generateConditionTemp(r,Number(n.state.doc_tmpl_type))),(0,y.jsxs)("div",{className:"node-container",children:[(0,y.jsx)("div",{className:"node-condition",children:(0,y.jsxs)("div",{className:w()("node-box","node-box-condition"),onClick:function(t){n.showDrawer(t,e,a)},children:[(0,y.jsx)("div",{className:"line-end-arrow"}),i.isHaveQuit&&n.generateCreateWarning("人员离职或用户组删除"),(0,y.jsxs)("div",{className:"title",children:[(0,y.jsx)("span",{className:"title-text",children:e.node_name}),(0,y.jsx)("span",{className:"node-priority",children:e.node_option}),(0,y.jsx)(Z.Z,{visible:!e.default,children:(0,y.jsx)("span",{className:"node-title-operate",children:(0,y.jsx)(E.Z,{onClick:function(e){n.deleteCondition(e,a)}})})})]}),(0,y.jsxs)("div",{className:w()("content",{"defaul-condition":e.default}),children:[(0,y.jsx)(Z.Z,{visible:!r&&!e.default,children:(0,y.jsxs)("div",{className:"no-condition",children:[(0,y.jsx)("span",{}),"请设置条件"]})}),(0,y.jsx)(Z.Z,{visible:!r&&e.default,children:"未满足其他条件分支的情况，将使用默认流程"}),(0,y.jsxs)(Z.Z,{visible:r,children:[(0,y.jsx)("div",{className:"condition-line",children:"需同时满足以下条件："},"title"),i.conditionsNode]})]})]})}),(0,y.jsx)("div",{className:"add-node-btn-box",children:(0,y.jsx)("div",{className:"add-node-btn",children:(0,y.jsx)(S.Z,{placement:"right",content:n.generateCreateNodeBtns(e.node_type,t,s),children:(0,y.jsx)("div",{className:"btn"})})})})]},e.key)},n.generateApprovalNode=function(e,t,s){var a=JSON.parse(e.node_value),r=n.haddleMembers(a.users),i=r.isHaveQuit,l=r.members,o=n.haddleRoles(a.roles),c=o.isEmpty,d=o.isDel,u=o.tooltip,p=o.roles;return(0,y.jsxs)("div",{className:"node-container",children:[(0,y.jsxs)("div",{className:w()("node-box","node-box-approval"),onClick:function(t){n.showDrawer(t,e)},children:[(0,y.jsx)("div",{className:"line-end-arrow"}),i&&n.generateCreateWarning("审批人已离职"),(c||d)&&n.generateCreateWarning(u),(0,y.jsxs)("div",{className:"title",children:[(0,y.jsx)("span",{className:"title-text",children:e.node_name}),(0,y.jsx)("span",{className:"node-title-operate",children:(0,y.jsx)(E.Z,{style:{color:"#898c96"},onClick:function(e){n.deleteNode(e,t,s)}})})]}),(0,y.jsx)(Z.Z,{visible:a.user_type==V.Dw,children:(0,y.jsx)("div",{className:"content",children:W(a.level_num)})}),(0,y.jsxs)(Z.Z,{visible:a.user_type==V.d,children:[(0,y.jsx)(Z.Z,{visible:l&&l.length>0,children:(0,y.jsx)("span",{className:"content",children:(0,y.jsxs)("div",{className:"condition-line",children:["指定成员：",l&&l]})})}),(0,y.jsx)(Z.Z,{visible:!l||0==l.length,children:(0,y.jsxs)("span",{className:"content no-condition",children:[(0,y.jsx)("span",{}),"请指定审批人"]})})]}),(0,y.jsx)(Z.Z,{visible:a.user_type==V.MZ,children:(0,y.jsx)(Z.Z,{visible:p&&p.length>0,children:(0,y.jsx)("span",{className:"content",children:(0,y.jsxs)("div",{className:"condition-line",children:["指定用户组：",p&&p]})})})}),(0,y.jsxs)(Z.Z,{visible:a.user_type==V.EN,children:[(0,y.jsx)(Z.Z,{visible:1==a.level_type,children:(0,y.jsxs)("div",{className:"content",children:["从直接主管到发起人向上的",W(a.level_num)]})}),(0,y.jsx)(Z.Z,{visible:2==a.level_type,children:(0,y.jsxs)("div",{className:"content",children:["从直接主管到通讯录级别最高的",A(a.level_num)]})})]})]}),(0,y.jsx)("div",{className:"add-node-btn-box",children:(0,y.jsx)("div",{className:"add-node-btn",children:(0,y.jsx)(S.Z,{placement:"right",content:n.generateCreateNodeBtns(e.node_type,t,s),children:(0,y.jsx)("div",{className:"btn"})})})})]},e.key)},n.generateFinancialNode=function(e,t,s){var a=JSON.parse(e.node_value),r=n.haddleMembers(a.users),i=r.isHaveQuit,l=r.members,o=n.haddleRoles(a.roles),c=o.isEmpty,d=o.isDel,u=o.tooltip,p=o.roles;return(0,y.jsxs)("div",{className:"node-container",children:[(0,y.jsxs)("div",{className:w()("node-box","node-box-financial"),onClick:function(t){n.showDrawer(t,e)},children:[(0,y.jsx)("div",{className:"line-end-arrow"}),i&&n.generateCreateWarning("审核人已离职"),(c||d)&&n.generateCreateWarning(u),(0,y.jsx)("div",{className:"title",children:(0,y.jsx)("span",{className:"title-text",children:e.node_name})}),(0,y.jsx)(Z.Z,{visible:1==a.user_type,children:(0,y.jsx)("span",{className:"content",children:(0,y.jsx)("div",{className:"condition-line",children:"全部审单会计"})})}),(0,y.jsx)(Z.Z,{visible:2==a.user_type&&l&&l.length>0,children:(0,y.jsx)("span",{className:"content",children:(0,y.jsxs)("div",{className:"condition-line",children:["审单会计：",l&&l]})})}),(0,y.jsx)(Z.Z,{visible:3==a.user_type&&l&&l.length>0,children:(0,y.jsx)("span",{className:"content",children:(0,y.jsxs)("div",{className:"condition-line",children:["指定成员：",l&&l]})})}),(0,y.jsx)(Z.Z,{visible:a.user_type==V.MZ,children:(0,y.jsx)(Z.Z,{visible:p&&p.length>0,children:(0,y.jsx)("span",{className:"content",children:(0,y.jsxs)("div",{className:"condition-line",children:["指定用户组：",p&&p]})})})})]}),(0,y.jsx)("div",{className:"add-node-btn-box",children:(0,y.jsx)("div",{className:"add-node-btn",children:(0,y.jsx)(S.Z,{placement:"right",content:n.generateCreateNodeBtns(e.node_type,t,s),children:(0,y.jsx)("div",{className:"btn"})})})})]},e.key)},n.generateNotifyNode=function(e,t,s){var a=JSON.parse(e.node_value),r=n.haddleMembers(a.users),i=r.isHaveQuit,l=r.members,o=a.level_num&&a.level_num.split(",").map((function(e){return W(e)}));return(0,y.jsxs)("div",{className:"node-container",children:[(0,y.jsxs)("div",{className:w()("node-box","node-box-notify"),onClick:function(t){n.showDrawer(t,e)},children:[(0,y.jsx)("div",{className:"line-end-arrow"}),i&&n.generateCreateWarning("抄送人已离职"),(0,y.jsxs)("div",{className:"title",children:[(0,y.jsx)("span",{className:"title-text",children:e.node_name}),(0,y.jsx)("span",{className:"node-title-operate",children:(0,y.jsx)(E.Z,{style:{color:"#898c96"},onClick:function(e){n.deleteNode(e,t,s)}})})]}),(0,y.jsx)(Z.Z,{visible:!(l&&0!=l.length||o&&0!=o.length),children:(0,y.jsxs)("span",{className:"content no-condition",children:[(0,y.jsx)("span",{}),"请指定抄送人"]})}),(0,y.jsx)(Z.Z,{visible:l&&l.length>0||o&&o.length>0,children:(0,y.jsx)("div",{className:"content",children:(0,y.jsxs)("div",{className:"condition-line",children:["指定成员：",l&&l,l&&o&&",",o&&o.join(",")]})})})]}),(0,y.jsx)("div",{className:"add-node-btn-box",children:(0,y.jsx)("div",{className:"add-node-btn",children:(0,y.jsx)(S.Z,{placement:"right",content:n.generateCreateNodeBtns(e.node_type,t,s),children:(0,y.jsx)("div",{className:"btn"})})})})]},e.key)},n.generatePaymentNode=function(e,t,s){var a=JSON.parse(e.node_value),r=n.haddleMembers(a.users),i=r.isHaveQuit,l=r.members,c=n.haddleRoles(a.roles),d=c.isEmpty,u=c.isDel,p=c.tooltip,h=c.roles;return(0,y.jsxs)("div",{className:"node-container",children:[(0,y.jsxs)("div",{className:w()("node-box","node-box-payment"),onClick:function(t){n.showDrawer(t,e)},children:[(0,y.jsx)("div",{className:"line-end-arrow"}),i&&n.generateCreateWarning("结算人已离职"),(d||u)&&n.generateCreateWarning(p),(0,y.jsxs)("div",{className:"title",children:[(0,y.jsx)("span",{className:"title-text",children:e.node_name}),(0,y.jsx)("span",{className:"node-switch",children:(0,y.jsx)(D.Z,{size:"small",onChange:function(t,s){!function(e,t,s){var a=JSON.parse(s.node_value);t&&t.preventDefault(),t&&t.stopPropagation(),a.pay_status=e?1:2,s.node_value=o()(a),n.setState({approvalFlowData:n.state.approvalFlowData})}(t,s,e)},checked:1==a.pay_status})})]}),(0,y.jsx)(Z.Z,{visible:1==a.user_type,children:(0,y.jsx)("span",{className:"content",children:(0,y.jsx)("div",{className:"condition-line",children:"全部出纳"})})}),(0,y.jsx)(Z.Z,{visible:2==a.user_type&&l&&l.length>0,children:(0,y.jsxs)("span",{className:"content",children:["M",(0,y.jsxs)("div",{className:"condition-line",children:["出纳：",l&&l]})]})}),(0,y.jsx)(Z.Z,{visible:3==a.user_type&&l&&l.length>0,children:(0,y.jsx)("span",{className:"content",children:(0,y.jsxs)("div",{className:"condition-line",children:["指定成员：",l&&l]})})}),(0,y.jsx)(Z.Z,{visible:a.user_type==V.MZ,children:(0,y.jsx)(Z.Z,{visible:h&&h.length>0,children:(0,y.jsx)("span",{className:"content",children:(0,y.jsxs)("div",{className:"condition-line",children:["指定用户组：",h&&h]})})})})]}),(0,y.jsx)("div",{className:"add-node-btn-box",children:(0,y.jsx)("div",{className:"add-node-btn",children:(0,y.jsx)(S.Z,{placement:"right",content:n.generateCreateNodeBtns(e.node_type,t,s),children:(0,y.jsx)("div",{className:"btn"})})})})]},e.key)},n.generateCreateWarning=function(e){return(0,y.jsx)(k.Z,{placement:"top",title:e,children:(0,y.jsx)("div",{className:"node-box-warning",children:(0,y.jsx)("img",{src:"https://apg-1258944054.cos.ap-guangzhou.myqcloud.com/apg/pc-micro-reimburse/common/%21.svg",alt:""})})})},n.haddleRoles=function(e){var n=!1,t=!1,s="";return{roles:e&&e.map((function(e,a){var r="";return e.is_del&&(t=!0,r="quit",s="用户组已删除"),e.is_empty&&(n=!0,r="quit",s="用户组无成员"),(0,y.jsx)("span",{className:r,children:"".concat(e.rname).concat(e.is_empty?"(无成员)":"").concat(e.is_del?"(已删除)":"")},"members"+e.rid)})),isEmpty:n,isDel:t,tooltip:s}},n.generateConditionTemp=function(e,t){var s=n.state.conditionLabelMap,a=(0,F.qW)([],"已删除");if(!e)return null;var r=!1,i=e.map((function(e,n){switch(e.type){case V.l9:var i=e.value&&e.value.split(",").map((function(e){var n=e.split("#"),t=d()(n,3),s=t[0],a=t[1],i="";return t[2]&&(r=!0,i="quit",a+="(已离职)"),(0,y.jsx)("span",{className:i,children:a},"members"+s)}));return(0,y.jsxs)("div",{className:"condition-line conditions",children:[s.commiter||q(V.l9),": ",B(e.compare)," ",i]},n);case V.Bv:var l=e.value&&e.value.split(",").map((function(e){var n=e.split("#"),t=d()(n,3),s=t[0],a=t[1],i=t[2],l="";return i&&"true"===i&&(r=!0,l="quit",a+="(已删除)"),(0,y.jsx)("span",{className:l,children:a},"members"+s)}));return(0,y.jsxs)("div",{className:"condition-line conditions",children:[q(V.Bv),": ",B(e.compare)," ",l]},n);case V.Fr:var o=e.value&&e.value.split(",").map((function(e){var n=e.split("#"),t=d()(n,2);return t[0],t[1]}));return(0,y.jsxs)("div",{className:"condition-line conditions",children:[s.department||q(V.Fr),": ",B(e.compare)," ",o.join(",")]},n);case V.Al:var c=e.value&&e.value.split(",").map((function(e){var n=e.split("#"),t=d()(n,2);return t[0],t[1]}));return(0,y.jsxs)("div",{className:"condition-line conditions",children:[s.title||q(V.Al),": ",B(e.compare)," ",c.join(",")]},n);case V.lt:var u=e.value&&e.value.split(",").map((function(e){var n=e.split("#"),t=d()(n,2);return t[0],t[1]}));return(0,y.jsxs)("div",{className:"condition-line conditions",children:[q(V.lt),": ",O(e.compare)," ",u.join(",")]},n);case V.w7:var p=e.value&&e.value.split(",").map((function(e){return a(e)}));return(0,y.jsxs)("div",{className:"condition-line conditions",children:[s.trans_way||q(V.w7),": ",O(e.compare)," ",p.join(",")]},n);case V.NY:var h=e.value&&e.value.split(",").map((function(e){return a(e)}));return(0,y.jsxs)("div",{className:"condition-line conditions",children:[s.travel_type||q(V.NY),": ",B(e.compare)," ",h.join(",")]},n);case V.l2:var m=e.value&&e.value.split(",").map((function(e){return e}));return(0,y.jsxs)("div",{className:"condition-line conditions",children:[q(V.l2),": ",B(e.compare)," ",m.join(",")]},n);case V.j4:var f=e.value&&e.value.split(","),v=d()(f,2),x=v[0],j=v[1];return(0,y.jsxs)("div",{className:"condition-line conditions",children:[ie(e.type,V.S_,t),": ",L(e.compare),+x,j&&" - ".concat(+j),"小时"]},n);case V.Bc:var b=e.value&&e.value.split(","),g=d()(b,2),N=g[0],_=g[1];return(0,y.jsxs)("div",{className:"condition-line conditions",children:[s.amount||ie(e.type,V.S_,t),": ",L(e.compare),(+N).div(100),_&&"-".concat((+_).div(100))]},n)}}));return{isHaveQuit:r,conditionsNode:i}},n.generateCreateNodeBtns=function(e,t,s){var a=function e(n){for(var s=n.slice(0,t+1),a=!1,r=0;r<s.length;r++){var i=s[r];if(i.node_type===V.KT&&i.lineNodes.forEach((function(n){a=e(n.child_nodes)})),i.node_type===V.PC){a=!0;break}}return a};return(0,y.jsxs)("div",{className:"add-button-container",children:[(0,y.jsx)(Z.Z,{visible:!a(s),children:(0,y.jsxs)("div",{className:"add-button-wrapper",children:[(0,y.jsx)("span",{className:"icon audit-icon",onClick:function(){n.onCreateNode(V.ux,t,s)}}),(0,y.jsx)("span",{style:{color:"#007AFF"},onClick:function(){n.onCreateNode(V.ux,t,s)},children:"审批人"})]})}),(0,y.jsxs)("div",{className:"add-button-wrapper",children:[(0,y.jsx)("span",{className:"icon cc-icon",onClick:function(){n.onCreateNode(V.k0,t,s)}}),(0,y.jsx)("span",{style:{color:"#F8A209"},onClick:function(){n.onCreateNode(V.k0,t,s)},children:"抄送人"})]}),(0,y.jsx)(Z.Z,{visible:function(n){return e===V.dA||n[t+1]&&n[t+1].node_type!=V.xV&&!a(n)}(s),children:(0,y.jsxs)("div",{className:"add-button-wrapper",children:[(0,y.jsx)("span",{className:"icon condition-icon",onClick:function(){n.onCreateNode(V.KT,t,s)}}),(0,y.jsx)("span",{style:{color:"#898C96"},onClick:function(){n.onCreateNode(V.KT,t,s)},children:"条件"})]})})]})},n.deleteCondition=function(e,t){e.stopPropagation(),M.Z.confirm({content:"是否确认删除该条件？",title:"提示",onOk:function(){if(t.currentNodes.lineNodes.length>2)t.currentNodes.lineNodes.splice(t.index,1),I(t.currentNodes.lineNodes);else{var e,s=t.currentNodes.lineNodes[1].child_nodes,a=t.approvalFlowData.findIndex((function(e){return e.key==t.currentNodes.key}));(e=t.approvalFlowData).splice.apply(e,[a,1].concat(i()(s)))}n.setState({approvalFlowData:n.state.approvalFlowData})}})},n.deleteNode=function(e,t,s){e.stopPropagation(),M.Z.confirm({content:"是否确认删除该节点？",title:"提示",onOk:function(){s.splice(t,1),n.setState({approvalFlowData:n.state.approvalFlowData})}})},n.addConditionNode=function(e){if(e.length>98)C.ZP.warn("最多能添加99个条件");else{var t=[];e.forEach((function(e){t=[].concat(i()(t),i()(z(e.child_nodes)))}));var s=[];t.includes(V.ux)&&s.push((0,V.yl)()),t.includes(V.Oh)&&s.push((0,V.du)()),t.includes(V.PC)&&s.push((0,V.ok)()),e.splice(-1,0,(0,V.lf)(s,"条件".concat(e.length))),I(e),n.setState({approvalFlowData:n.state.approvalFlowData}),console.log(n.state.approvalFlowData)}},n.onCreateNode=function(e,t,s){var a=s[t],r=n.state.template;switch(e){case V.ux:a.node_type==V.dA?a.child_nodes.unshift((0,V.yl)()):s.splice(t+1,0,(0,V.yl)());break;case V.k0:a.node_type==V.dA?a.child_nodes.unshift((0,V.y5)()):s.splice(t+1,0,(0,V.y5)());break;case V.KT:var i,l=Q(s),o=s[s.length-1];i=a.node_type==V.dA?a.child_nodes:t<l?t+1===l?s.slice(t+1,-1):s.slice(t+1,l):1==r?o.node_type==V.xV?s.slice(t+1,-1):s.slice(t+1):o.node_type==V.xV?s.slice(t+1,-2):s.slice(t+1);var c=[],d=z(i);d.includes(V.ux)&&c.push((0,V.yl)()),d.includes(V.Oh)&&c.push((0,V.du)()),d.includes(V.PC)&&c.push((0,V.ok)()),a.node_type==V.dA?a.child_nodes=[{node_type:e,key:G(),lineNodes:[(0,V.lf)(c),(0,V.lf)(i,"默认条件","优先级2",!0)]}]:s.splice(t+1,i.length,{node_type:e,key:G(),lineNodes:[(0,V.lf)(c),(0,V.lf)(i,"默认条件","优先级2",!0)]})}n.setState({approvalFlowData:n.state.approvalFlowData}),console.log(n.state.approvalFlowData)},n.onShowDrawer=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ae=e,t&&(re=t),e.default||n.setState({drawerVisible:!0})},n.showDrawer=function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n.onShowDrawer(t,s)},n.onCloseDrawer=function(){n.setState({drawerVisible:!1})},n.generateDrawerContent=function(){switch(ae.node_type){case V.ux:return(0,y.jsx)(K.default,{drawerData:ae,onCloseDrawer:n.onCloseDrawer,onSubmit:n.onDrawerSubmit});case V.dA:return(0,y.jsx)($.default,{drawerData:ae,onChangePriority:n.onChangePriority,lineNodesConfig:re,onCloseDrawer:n.onCloseDrawer,onSubmit:n.onDrawerSubmit,conditionLabelMap:n.state.conditionLabelMap});case V.Oh:return(0,y.jsx)(Y.default,{drawerData:ae,onCloseDrawer:n.onCloseDrawer,onSubmit:n.onDrawerSubmit});case V.PC:return(0,y.jsx)(U.default,{drawerData:ae,onCloseDrawer:n.onCloseDrawer,onSubmit:n.onDrawerSubmit});case V.k0:return(0,y.jsx)(X.default,{drawerData:ae,onCloseDrawer:n.onCloseDrawer,onSubmit:n.onDrawerSubmit})}},n.onChangePriority=function(e,t){console.log(re);var s=[re.currentNodes.lineNodes[t],re.currentNodes.lineNodes[e]];re.currentNodes.lineNodes[e]=s[0],re.currentNodes.lineNodes[t]=s[1],I(re.currentNodes.lineNodes),n.setState({approvalFlowData:n.state.approvalFlowData})},n.onDrawerSubmit=function(e){ae.node_value=e.node_value,ae.node_name=e.node_name,n.setState({approvalFlowData:n.state.approvalFlowData,drawerVisible:!1})},n.scaleContent=function(e){var t=n.state,s=t.scale,a=t.scaleStyle;if("-"==e){if(s<=.5)return;s=+(s-=.1).toFixed(1)}else{if(1==s)return;s=+(s+=.1).toFixed(1)}a={MsTransform:"scale(".concat(s,")"),MozTransform:"scale(".concat(s,")"),WebkitTransform:"scale(".concat(s,")"),transform:"scale(".concat(s,")")},n.setState({scale:s,scaleStyle:a})},n.setTempTitleEdit=function(){n.setState({tempTitleEdit:!0},(function(){n.tempTitleRef.current.focus()}))},n.onTempTitleChange=function(e){n.setState({template_name:e.target.value})},n.onTempTitleBlur=function(){n.setState({tempTitleEdit:!1})},n.onCancel=function(){M.Z.confirm({title:"提示",content:"取消后配置的内容将不会保存，确定取消吗？",onOk:function(){n.goBack()}})},n.afterVisibleChange=function(e){e?setTimeout((function(){document.querySelector("body").setAttribute("style","overflow-y: hidden; touch-action: none;")})):setTimeout((function(){document.querySelector("body").setAttribute("style","overflow-y: auto")}),0)},n.goBack=function(){sessionStorage.setItem("echo_selected_custom_doc_tmpl",o()({type:Number(n.state.template_type),currTab:"1"})),history.back()},n.state={approvalFlowData:[],drawerVisible:!1,approvalDrawerModel:{},tempTitleEdit:!1,titleEditable:!1,scaleStyle:null,scale:1,submitLoading:!1,template_name:null,template_id:null,template_type:null,doc_tmpl_type:null,conditions_quit:!1,conditionLabelMap:{},template:2},n.showDrawer=(300,!1,void 0===(t=n.showDrawer)?se(300,false,!1):se(300,t,!1)),n}return m()(r,[{key:"componentDidMount",value:function(){this.initData()}},{key:"generateRouteNode",value:function(e,n,t){var s=this;return(0,y.jsxs)("div",{className:"node-container",children:[(0,y.jsx)("div",{className:"branch-wrap",children:(0,y.jsx)("div",{className:"branch-wrap-box",children:(0,y.jsxs)("div",{className:"branch-box",children:[(0,y.jsx)("div",{className:"add-branch",onClick:function(){s.addConditionNode(e.lineNodes)},children:"添加条件"}),e.lineNodes.map((function(n,a){return(0,y.jsxs)("div",{className:"col-box",children:[(0,y.jsxs)(Z.Z,{visible:0==a,children:[(0,y.jsx)("div",{className:"top-left-cover-line"}),(0,y.jsx)("div",{className:"bottom-left-cover-line"})]}),(0,y.jsxs)(Z.Z,{visible:a==e.lineNodes.length-1,children:[(0,y.jsx)("div",{className:"top-right-cover-line"}),(0,y.jsx)("div",{className:"bottom-right-cover-line"})]}),s.generateSelectorNode(n,a,e.lineNodes,{currentNodes:e,index:a,approvalFlowData:t}),s.generateNodeContainer(n.child_nodes)]},n.key)}))]})})}),(0,y.jsx)("div",{className:"add-node-btn-box",children:(0,y.jsx)("div",{className:"add-node-btn",children:(0,y.jsx)(S.Z,{placement:"right",content:this.generateCreateNodeBtns(e.node_type,n,t),children:(0,y.jsx)("div",{className:"btn"})})})})]},e.key)}},{key:"haddleMembers",value:function(e){var n=!1;return{members:e&&e.map((function(e,t){var s="";return(e.leave||e.is_del||e.is_empty)&&(n=!0,s="quit"),(0,y.jsx)("span",{className:s,children:"".concat(e.uname).concat(e.leave?"(已离职)":"")},"members"+e.uid)})),isHaveQuit:n}}},{key:"haddleQuit",value:function(e){var n=!1;return e&&e.map((function(e){e.leave&&(n=!0)})),n}},{key:"haddleRoleStatus",value:function(e){var n=!1;return e&&e.forEach((function(e){(e.is_empty||e.is_del)&&(n=!0)})),n}},{key:"render",value:function(){var e=this,n=this.state,t=n.tempTitleEdit,s=n.template_name,a=n.submitLoading;return(0,y.jsxs)("div",{className:"approvalFlow_frame",children:[(0,y.jsxs)("div",{className:"scale-bar",children:[(0,y.jsx)("span",{className:"ctrl-btn",onClick:function(){e.scaleContent("-")},children:"-"}),(0,y.jsxs)("span",{children:[100*this.state.scale,"%"]}),(0,y.jsx)("span",{className:"ctrl-btn",onClick:function(){e.scaleContent("+")},children:"+"})]}),(0,y.jsxs)("div",{className:"approvalFlow_header",children:[(0,y.jsx)("span",{className:"back",onClick:this.goBack,children:(0,y.jsx)(ee.Z,{})}),(0,y.jsxs)("span",{className:"title",children:[(0,y.jsx)(Z.Z,{visible:!t,children:(0,y.jsxs)("div",{className:"temp-title",onClick:this.setTempTitleEdit,children:[(0,y.jsx)("span",{className:"text",style:{fontSize:16},children:s}),(0,y.jsx)("span",{className:"edit-icon"})]})}),(0,y.jsx)(Z.Z,{visible:t,children:(0,y.jsx)(P.Z,{maxLength:20,value:s,onChange:this.onTempTitleChange,onBlur:this.onTempTitleBlur,ref:this.tempTitleRef,style:{width:"50%"}})})]}),(0,y.jsxs)("span",{className:"approvalFlow_header_btn_bar",children:[(0,y.jsx)(R.Z,{type:"text",onClick:function(){e.onCancel()},children:"取消"}),(0,y.jsx)(R.Z,{type:"primary",loading:a,onClick:this.onSaveTemp,children:"保存"})]})]}),(0,y.jsx)("div",{id:"approvalFlow",children:(0,y.jsx)("div",{className:"approvalFlow-content-outer",children:(0,y.jsx)("div",{className:"approvalFlow-content",style:this.state.scaleStyle,children:this.generateNodeContainer(this.state.approvalFlowData)})})}),(0,y.jsx)(T.Z,{width:"60%",placement:"right",onClose:this.onCloseDrawer,visible:this.state.drawerVisible,id:"approval-flow-drawer",destroyOnClose:!0,afterVisibleChange:this.afterVisibleChange,closable:!1,children:this.generateDrawerContent()})]})}}]),r}(N.Component)}}]);