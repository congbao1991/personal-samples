(self.webpackChunkreact_webpack=self.webpackChunkreact_webpack||[]).push([[8808],{24457:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>J});var a=n(58548),r=n.n(a),l=n(78829),o=n.n(l),i=n(51765),s=n.n(i),c=n(93287),m=n.n(c),u=n(24309),d=n.n(u),p=n(33929),v=n.n(p),f=n(63497),h=n.n(f),E=n(69984),y=n.n(E),b=n(74720),g=n.n(b),N=n(9830),_=n.n(N),w=n(30695),Z=n.n(w),C=n(83507),S=n.n(C),k=n(69024),D=n.n(k),M=n(600),x=n.n(M),P=n(67294),R=n(49101),T=n(34046),V=n(34041),F=n(48086),B=n(14617),L=n(47933),O=n(71577),q=n(41584),W=n(88675),A=n(85907),j=n(23148),G=n(45724);function H(e,t){var n=v()(e);if(d()){var a=d()(e);t&&(a=a.filter((function(t){return m()(e,t).enumerable}))),n.push.apply(n,a)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){y()(e,t,n[t])})):s()?o()(e,s()(n)):H(Object(n)).forEach((function(t){r()(e,t,m()(n,t))}))}return e}var z=V.Z.Option;const J=function(e){S()(r,e);var t,n,a=(t=r,n=function(){if("undefined"==typeof Reflect||!h())return!1;if(h().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(h()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=x()(t);if(n){var r=x()(this).constructor;e=h()(a,arguments,r)}else e=a.apply(this,arguments);return D()(this,e)});function r(e){var t;_()(this,r),(t=a.call(this,e)).inputRef=(0,P.createRef)(),t.editMemberRef=P.createRef(),t.submit=function(){var e=t.state.config,n=e.user_type,a=e.users,r=e.roles,l=e.sign_method,o=void 0===l?2:l,i=e.leader_level,s=void 0===i?"1":i,c=e.root_level,m=void 0===c?"1":c,u=e.level_type,d=void 0===u?1:u,p=e.if_empty,v=void 0===p?1:p;if(a=a&&a.filter((function(e){return!e.leave})),n!==G.d||a&&0!=a.length)if(n!==G.MZ||r&&0!=r.length)if(n===G.MZ&&r.some((function(e){return e.is_empty})))F.ZP.warn("用户组为空，请添加用户组");else if(n===G.MZ&&r.some((function(e){return e.is_del})))F.ZP.warn("用户组为空，请添加用户组");else{var f={user_type:n};switch(n){case G.Dw:f.sign_method=o,f.level_num=s;break;case G.d:f.users=a,a.length>1&&(f.sign_method=o);break;case G.EN:f.level_type=d,f.sign_method=o,1==f.level_type?f.level_num=s:f.level_num=m;break;case G.MZ:f.sign_method=o,f.if_empty=v,f.roles=r.map((function(e){return{rid:e.role_id,rname:e.role_name}}))}t.state.approvalDrawerModel.node_value=g()(f),console.log("更新后的节点数据",t.state.approvalDrawerModel),t.props.onSubmit(t.state.approvalDrawerModel)}else F.ZP.warn("请选择指定用户组");else F.ZP.warn("请选择指定人员")},t.onRadioChange=function(e,n){t.state.config[n]=e.target.value,t.setState({config:t.state.config})},t.onCloseDrawer=function(){t.props.onCloseDrawer()},t.closeMember=function(){t.setState({memberSelectorVisible:!1})},t.showMemberSelector=function(){t.setState({memberSelectorVisible:!0}),t.editMemberRef.current.wrappedInstance.setCheck((t.state.config.users||[]).filter((function(e){return!e.leave})))},t.memberSelectorCallback=function(e){if(e.length>20)F.ZP.warn("最多可添加20个成员");else{var n=t.state.config;n.users=e.map((function(e){return{uid:e.id.toString(),uname:"string"==typeof e.name?e.name:e.name.props.children}})),t.setState({config:n,memberSelectorVisible:!1})}},t.onTitleChange=function(e){t.state.approvalDrawerModel.node_name=e.target.value,t.setState({approvalDrawerModel:t.state.approvalDrawerModel})},t.onSelectChange=function(e,n){t.state.config[n]=e,t.setState({config:t.state.config})},t.onTitleBlur=function(){t.setState({titleEditable:!1})},t.onTitleEdit=function(){t.setState({titleEditable:!0},(function(){t.inputRef.current.focus()}))},t.onDeleteMember=function(e){t.state.config.users.splice(e,1),t.setState({config:t.state.config})},t.onDeleteRole=function(e){t.state.config.roles.splice(e,1),t.setState({config:t.state.config})},t.showRoleSelector=function(){t.setState({roleSelectorVisible:!0})},t.onHideRolePicker=function(){t.setState({roleSelectorVisible:!1})},t.initData=function(){if(t.state.approvalDrawerModel.node_value){var e=JSON.parse(t.state.approvalDrawerModel.node_value);console.log("抽屉初始化数据",e),e.user_type===G.EN?1==e.level_type?e.leader_level=e.level_num:e.root_level=e.level_num:e.leader_level=e.level_num,e.user_type===G.MZ&&(e.roles=(e.roles||[]).map((function(e){return{role_id:e.rid,role_name:e.rname,is_empty:e.is_empty,is_del:e.is_del}}))),e.sign_method||(e.sign_method=2),t.setState({config:e})}};var n=(0,q.p$)(t.props.drawerData);return t.state={approvalDrawerModel:n,titleEditable:!1,memberSelectorVisible:!1,config:{},treeData:[],roleData:[],roleSelectorVisible:!1},t}return Z()(r,[{key:"componentDidMount",value:function(){this.initData()}},{key:"render",value:function(){var e=this,t=this.state,n=t.approvalDrawerModel,a=t.titleEditable,r=t.config,l=(t.memberSelectorVisible,t.treeData,t.roleSelectorVisible,[]);return r.roles&&(l=r.roles.map((function(e){return I(I({},e),{},{key:e.role_id,title:e.role_name,uname:e.role_name})}))),P.createElement("div",{style:{height:"100vh",position:"relative"}},P.createElement("div",{className:"drawer-header"},P.createElement(T.Z,{visible:!a},P.createElement("span",{className:"edit-title"},n.node_name),P.createElement("span",{className:"edit-icon",onClick:this.onTitleEdit,style:{marginLeft:10}})),P.createElement(T.Z,{visible:a},P.createElement(B.Z,{maxLength:20,value:n.node_name,ref:this.inputRef,onChange:this.onTitleChange,onBlur:this.onTitleBlur,style:{width:300}}))),P.createElement("div",{className:"drawer-content-wrapper"},P.createElement("h1",{className:"drawer-title"},"设置审批人"),P.createElement(L.ZP.Group,{name:"radiogroup",className:"approval-type-radio-group",onChange:function(t){e.onRadioChange(t,"user_type")},value:r.user_type},P.createElement(L.ZP,{className:"approval-type-radio",value:G.Dw},"指定主管"),P.createElement(L.ZP,{className:"approval-type-radio",value:G.d},"指定成员"),P.createElement(L.ZP,{className:"approval-type-radio",value:G.EN},"连续多级主管",P.createElement(W.Z,null,"发起人向上的各级主管依次审批")),P.createElement(L.ZP,{className:"approval-type-radio",value:G.MZ},"指定用户组",P.createElement(j.default,null))),P.createElement(T.Z,{visible:r.user_type==G.Dw},P.createElement("div",null,P.createElement("span",{style:{marginRight:14}},"发起人的"),P.createElement(V.Z,{className:"approval-level-select",onChange:function(t){e.onSelectChange(t,"leader_level")},value:r.leader_level||"1"},G.w9.map((function(e){return P.createElement(z,{value:e.value,key:e.value},e.label)}))))),P.createElement(T.Z,{visible:r.user_type==G.d},P.createElement("h1",{className:"drawer-title"},"添加成员：",P.createElement("span",{className:"sub-title"},"（不超过20个）")),P.createElement(T.Z,{visible:r.users&&r.users.length>0},P.createElement(A.default,{showSelector:this.showMemberSelector,onDelete:this.onDeleteMember,members:r.users})),P.createElement(O.Z,{onClick:this.showMemberSelector,type:"primary",className:"drawer-add-member"},P.createElement(R.Z,{className:"drawer-add-member-icon"})," 添加指定成员")),P.createElement(T.Z,{visible:r.user_type==G.MZ},P.createElement("h1",{className:"drawer-title"},"添加用户组：",P.createElement("span",{className:"sub-title"},"（单选）")),P.createElement(T.Z,{visible:r.roles&&r.roles.length>0},P.createElement(A.default,{showSelector:this.showRoleSelector,onDelete:this.onDeleteRole,members:l})),P.createElement(O.Z,{onClick:this.showRoleSelector,type:"primary",className:"drawer-add-member"},P.createElement(R.Z,{className:"drawer-add-member-icon"})," 添加用户组")),P.createElement(T.Z,{visible:r.user_type==G.EN},P.createElement("h1",{className:"drawer-title"},"根据申请人执行依次向上审批："),P.createElement(L.ZP.Group,{name:"approve",value:r.level_type||1,onChange:function(t){e.onRadioChange(t,"level_type")}},P.createElement("div",{style:{marginBottom:16}},P.createElement(L.ZP,{value:1},P.createElement("span",{className:"text-split"},"直到发起人向上的")),P.createElement(V.Z,{className:"approval-level-select",onChange:function(t){e.onSelectChange(t,"leader_level")},value:r.leader_level||"1"},G.w9.map((function(e){return P.createElement(z,{value:e.value,key:e.value},e.label)})))),P.createElement("div",null,P.createElement(L.ZP,{value:2},P.createElement("span",{className:"text-split"},"直到通讯录中")),P.createElement(V.Z,{className:"approval-level-select",onChange:function(t){e.onSelectChange(t,"root_level")},value:r.root_level||"1"},G.LI.map((function(e){return P.createElement(z,{value:e.value,key:e.value},e.label)})))))),P.createElement(T.Z,{visible:G.EZ.includes(r.user_type)||r.user_type==G.d&&r.users&&r.users.length>1},P.createElement("h1",{className:"drawer-title approval-type-title"},"多人审批时采用的审批方式："),P.createElement(L.ZP.Group,{name:"radiogroup",onChange:function(t){e.onRadioChange(t,"sign_method")},value:r.sign_method||2},P.createElement(L.ZP,{style:{marginBottom:10},value:2},"或签（一名审批人同意或拒绝即可）"),P.createElement("br",null),P.createElement(L.ZP,{value:1},"会签（须所有审批人同意）"))),P.createElement(T.Z,{visible:r.user_type==G.MZ},P.createElement("h1",{className:"drawer-title approval-type-title"},"审批人为空时候："),P.createElement(L.ZP.Group,{name:"radiogroup",onChange:function(t){e.onRadioChange(t,"if_empty")},value:(0,q.xb)(r.if_empty)?1:r.if_empty},P.createElement(L.ZP,{style:{marginBottom:10},value:2},"自动通过",P.createElement(W.Z,null,"当该用户组或主管没有人的时候，审批单将自动通过")),P.createElement("br",null),P.createElement(L.ZP,{value:1},"自动转交管理员",P.createElement(W.Z,null,"当用户组或主管为空时，审批单会自动转交给超级管理员"))))),P.createElement("div",{className:"button-bar"},P.createElement(O.Z,{type:"primary",onClick:function(){e.submit()}},"确定"),P.createElement(O.Z,{onClick:this.onCloseDrawer},"取消")))}}]),r}(P.Component)},40663:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>z});var a=n(58548),r=n.n(a),l=n(78829),o=n.n(l),i=n(51765),s=n.n(i),c=n(93287),m=n.n(c),u=n(24309),d=n.n(u),p=n(33929),v=n.n(p),f=n(63497),h=n.n(f),E=n(69984),y=n.n(E),b=n(74720),g=n.n(b),N=n(9830),_=n.n(N),w=n(30695),Z=n.n(w),C=n(83507),S=n.n(C),k=n(69024),D=n.n(k),M=n(600),x=n.n(M),P=n(67294),R=n(41584),T=n(34046),V=n(48086),F=n(14617),B=n(47933),L=n(9676),O=n(71577),q=n(49101),W=n(88675),A=n(85907),j=n(23148),G=n(45724);function H(e,t){var n=v()(e);if(d()){var a=d()(e);t&&(a=a.filter((function(t){return m()(e,t).enumerable}))),n.push.apply(n,a)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){y()(e,t,n[t])})):s()?o()(e,s()(n)):H(Object(n)).forEach((function(t){r()(e,t,m()(n,t))}))}return e}var z=function(e){S()(r,e);var t,n,a=(t=r,n=function(){if("undefined"==typeof Reflect||!h())return!1;if(h().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(h()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=x()(t);if(n){var r=x()(this).constructor;e=h()(a,arguments,r)}else e=a.apply(this,arguments);return D()(this,e)});function r(e){var t;return _()(this,r),(t=a.call(this,e)).inputRef=(0,P.createRef)(),t.editMemberRef=(0,P.createRef)(),t.submit=function(){var e=t.state.config,n=e.user_type,a=e.sign_method,r=void 0===a?2:a,l=e.roles,o=e.if_empty,i=void 0===o?1:o,s=t.state.users;if(s=s&&s.filter((function(e){return!e.leave})),3!==n||s&&0!=s.length)if(n!==G.MZ||l&&0!=l.length)if(n===G.MZ&&l.some((function(e){return e.is_empty})))V.ZP.warn("用户组为空，请添加用户组");else if(n===G.MZ&&l.some((function(e){return e.is_del})))V.ZP.warn("用户组为空，请添加用户组");else{var c={};switch(n){case 1:if(t.state.checkedList.length==t.state.financialMembers.length)c.user_type=1,c.sign_method=r;else{var m=t.state.financialMembers.filter((function(e){return t.state.checkedList.some((function(t){return t==e.uid&&!e.leave}))}));if(0==m.length)return void V.ZP.warn("请选择指定审单会计");1==m.length?c.sign_method=2:c.sign_method=r,c.users=m,c.user_type=2}break;case 3:c.users=s,c.user_type=3,1==s.length?c.sign_method=2:c.sign_method=r;break;case G.MZ:c.user_type=G.MZ,c.sign_method=r,c.if_empty=i,c.roles=l.map((function(e){return{rid:e.role_id,rname:e.role_name}}))}t.state.drawerModel.node_value=g()(c),console.log("更新后的节点数据",t.state.drawerModel),t.props.onSubmit(t.state.drawerModel)}else V.ZP.warn("请选择指定用户组");else V.ZP.warn("请选择指定人员")},t.onTitleBlur=function(){t.setState({titleEditable:!1})},t.onRadioChange=function(e,n){var a=t.state.checkedList;1==e.target.value&&"user_type"==n&&(a=t.state.financialMembers.map((function(e){return e.uid}))),t.state.config[n]=e.target.value,t.setState({config:t.state.config,checkedList:a})},t.onTitleEdit=function(){t.setState({titleEditable:!0},(function(){t.inputRef.current.focus()}))},t.onCloseDrawer=function(){t.props.onCloseDrawer()},t.onTitleChange=function(e){t.state.drawerModel.node_name=e.target.value,t.setState({drawerModel:t.state.drawerModel})},t.showMemberSelector=function(){t.setState({memberSelectorVisible:!0}),t.editMemberRef.current.wrappedInstance.setCheck((t.state.users||[]).filter((function(e){return!e.leave})))},t.onDeleteMember=function(e){t.state.users.splice(e,1),t.setState({users:t.state.users})},t.closeMember=function(){t.setState({memberSelectorVisible:!1})},t.onCheckboxGroupChange=function(e){t.setState({checkedList:e})},t.memberSelectorCallback=function(e){var n=t.state.users;e.length>20?V.ZP.warn("最多可添加20个成员"):(n=e.map((function(e){return{uid:e.id.toString(),uname:"string"==typeof e.name?e.name:e.name.props.children}})),t.setState({users:n,memberSelectorVisible:!1}))},t.onDeleteRole=function(e){t.state.config.roles.splice(e,1),t.setState({config:t.state.config})},t.showRoleSelector=function(){t.setState({roleSelectorVisible:!0})},t.onHideRolePicker=function(){t.setState({roleSelectorVisible:!1})},t.initData=function(){},t.state={drawerModel:(0,R.p$)(t.props.drawerData),titleEditable:!1,treeData:[],config:{},financialMembers:[],memberSelectorVisible:!1,checkedList:[],roleData:[],roleSelectorVisible:!1},t}return Z()(r,[{key:"componentDidMount",value:function(){this.initData()}},{key:"render",value:function(){var e=this,t=this.state,n=t.titleEditable,a=t.drawerModel,r=t.config,l=t.financialMembers,o=(t.treeData,t.memberSelectorVisible,t.checkedList),i=t.users,s=(t.roleSelectorVisible,[]);return r.roles&&(s=r.roles.map((function(e){return I(I({},e),{},{key:e.role_id,title:e.role_name,uname:e.role_name})}))),P.createElement("div",{style:{height:"100vh",position:"relative"}},P.createElement("div",{className:"drawer-header"},P.createElement(T.Z,{visible:!n},P.createElement("span",{className:"edit-title"},a.node_name),P.createElement("span",{className:"edit-icon",onClick:this.onTitleEdit,style:{marginLeft:10}})),P.createElement(T.Z,{visible:n},P.createElement(F.Z,{maxLength:20,value:a.node_name,ref:this.inputRef,onChange:this.onTitleChange,onBlur:this.onTitleBlur,style:{width:300}}))),P.createElement("div",{className:"drawer-content-wrapper"},P.createElement("h1",{className:"drawer-title"},"设置审核人"),P.createElement(B.ZP.Group,{name:"radiogroup",className:"approval-type-radio-group",onChange:function(t){e.onRadioChange(t,"user_type")},value:r.user_type},P.createElement(B.ZP,{className:"approval-type-radio",value:1},"全部审单会计"),P.createElement(B.ZP,{className:"approval-type-radio",value:3},"指定成员"),P.createElement(B.ZP,{className:"approval-type-radio",value:G.MZ},"指定用户组",P.createElement(j.default,null))),P.createElement(T.Z,{visible:1==r.user_type&&l&&0==l.length},P.createElement("div",{className:"setting-member-tips"},P.createElement("span",{className:"icon"}),P.createElement("span",{className:"text"},"未设置财务权限人员，请先前往"),P.createElement("span",{className:"highlight-text"},"【企业设置-权限管理】"),P.createElement("span",{className:"text"},"中设置"))),P.createElement(T.Z,{visible:1==r.user_type&&l&&l.length>0},P.createElement("div",null,P.createElement(L.Z.Group,{onChange:this.onCheckboxGroupChange,defaultValue:o},l.map((function(e){return P.createElement(L.Z,{value:e.uid,key:e.uid,className:e.leave?"quit":""},e.uname+(e.leave?"(已离职)":""))}))))),P.createElement(T.Z,{visible:3==r.user_type},P.createElement("h1",{className:"drawer-title"},"添加成员：",P.createElement("span",{className:"sub-title"},"（不超过20个）")),P.createElement(T.Z,{visible:i&&i.length>0},P.createElement(A.default,{showSelector:this.showMemberSelector,onDelete:this.onDeleteMember,members:i})),P.createElement(O.Z,{onClick:this.showMemberSelector,type:"primary",className:"drawer-add-member"},P.createElement(q.Z,{className:"drawer-add-member-icon"})," 添加指定成员")),P.createElement(T.Z,{visible:r.user_type==G.MZ},P.createElement("h1",{className:"drawer-title"},"添加用户组：",P.createElement("span",{className:"sub-title"},"（单选）")),P.createElement(T.Z,{visible:r.roles&&r.roles.length>0},P.createElement(A.default,{showSelector:this.showRoleSelector,onDelete:this.onDeleteRole,members:s})),P.createElement(O.Z,{onClick:this.showRoleSelector,type:"primary",className:"drawer-add-member"},P.createElement(q.Z,{className:"drawer-add-member-icon"})," 添加用户组")),P.createElement(T.Z,{visible:r.user_type===G.MZ||1==r.user_type&&o.length>1||3==r.user_type&&i&&i.length>1},P.createElement("h1",{className:"drawer-title approval-type-title"},"多人审批时采用的审批方式"),P.createElement(B.ZP.Group,{name:"radiogroup",onChange:function(t){e.onRadioChange(t,"sign_method")},value:r.sign_method||2},P.createElement(B.ZP,{style:{marginBottom:10},value:2},"或签（一名审批人同意或拒绝即可）"),P.createElement("br",null),P.createElement(B.ZP,{value:1},"会签（须所有审批人同意）"))),P.createElement(T.Z,{visible:r.user_type==G.MZ},P.createElement("h1",{className:"drawer-title approval-type-title"},"审批人为空时候："),P.createElement(B.ZP.Group,{name:"radiogroup",onChange:function(t){e.onRadioChange(t,"if_empty")},value:(0,R.xb)(r.if_empty)?1:r.if_empty},P.createElement(B.ZP,{style:{marginBottom:10},value:2},"自动通过",P.createElement(W.Z,null,"当该用户组或主管没有人的时候，审批单将自动通过")),P.createElement("br",null),P.createElement(B.ZP,{value:1},"自动转交管理员",P.createElement(W.Z,null,"当用户组或主管为空时，审批单会自动转交给超级管理员"))))),P.createElement("div",{className:"button-bar"},P.createElement(O.Z,{type:"primary",onClick:function(){e.submit()}},"确定"),P.createElement(O.Z,{onClick:this.onCloseDrawer},"取消")))}}]),r}(P.Component)},85907:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>g});var a,r=n(63497),l=n.n(r),o=n(9830),i=n.n(o),s=n(30695),c=n.n(s),m=n(83507),u=n.n(m),d=n(69024),p=n.n(d),v=n(600),f=n.n(v),h=n(67294),E=n(57016),y=n(71577),b=n(31097);var g=(0,n(16550).EN)(a=function(e){u()(r,e);var t,n,a=(t=r,n=function(){if("undefined"==typeof Reflect||!l())return!1;if(l().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(l()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=f()(t);if(n){var r=f()(this).constructor;e=l()(a,arguments,r)}else e=a.apply(this,arguments);return p()(this,e)});function r(){var e;i()(this,r);for(var t=arguments.length,n=new Array(t),l=0;l<t;l++)n[l]=arguments[l];return(e=a.call.apply(a,[this].concat(n))).onDelete=function(t,n){t&&t.stopPropagation(),e.props.onDelete(n)},e.linkRolePage=function(t){t.preventDefault(),t.stopPropagation(),E.Z.confirm({title:"提示",content:"设置用户组不会保存当前审批流，确认要去设置用户组吗",cancelText:"取消",okText:"去设置",zIndex:2e3,onOk:function(){e.props.history.replace("/company/roles/index")}})},e.generateMemberEl=function(t,n){if(t.is_empty){var a=h.createElement("div",null,"该用户组下没有成员,",h.createElement(y.Z,{style:{padding:0},type:"link",onClick:e.linkRolePage},"前往设置"));return h.createElement(b.Z,{key:n,placement:"top",title:a},h.createElement("div",{className:"member-box quit"},h.createElement("span",{className:"img-box"},t.uname.substr(0,1)),h.createElement("span",{className:"member-name"},"".concat(t.uname).concat(t.leave?"(已离职)":"").concat(t.is_del?"(已删除)":"")),h.createElement("span",{className:"member-tip-icon"},h.createElement("img",{src:"https://apg-1258944054.cos.ap-guangzhou.myqcloud.com/apg/pc-micro-reimburse/common/%21.png",alt:""})),h.createElement("i",{className:"member-delete",onClick:function(t){e.onDelete(t,n)}})))}return h.createElement("div",{key:n,className:"member-box ".concat(t.leave||t.is_del?"quit":"")},h.createElement("span",{className:"img-box"},t.uname.substr(0,1)),h.createElement("span",{className:"member-name"},"".concat(t.uname).concat(t.leave?"(已离职)":"").concat(t.is_del?"(已删除)":"")),h.createElement("i",{className:"member-delete",onClick:function(t){e.onDelete(t,n)}}))},e}return c()(r,[{key:"render",value:function(){var e=this,t=this.props.members;return h.createElement("div",{className:"selected-member-wrapper",onClick:function(){e.props.showSelector&&e.props.showSelector()}},t.map((function(t,n){return e.generateMemberEl(t,n)})))}}]),r}(h.Component))||a},75238:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>D});var a=n(63497),r=n.n(a),l=n(74720),o=n.n(l),i=n(9830),s=n.n(i),c=n(30695),m=n.n(c),u=n(83507),d=n.n(u),p=n(69024),v=n.n(p),f=n(600),h=n.n(f),E=n(67294),y=n(41584),b=n(34046),g=n(34041),N=n(48086),_=n(14617),w=n(71577),Z=n(85907),C=n(49101),S=n(45724);var k=g.Z.Option,D=function(e){d()(l,e);var t,n,a=(t=l,n=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(r()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=h()(t);if(n){var l=h()(this).constructor;e=r()(a,arguments,l)}else e=a.apply(this,arguments);return v()(this,e)});function l(e){var t;return s()(this,l),(t=a.call(this,e)).inputRef=(0,E.createRef)(),t.editMemberRef=(0,E.createRef)(),t.submit=function(){var e=t.state.config,n=e.cc_superiors,a=e.users;if(a=a.filter((function(e){return!e.leave})),n&&0!=n.length||a&&0!=a.length){var r={};a&&a.length>0&&(r.users=a),n&&n.length>0&&(r.level_num=n.map((function(e){return e.level_num})).join(",")),t.state.drawerModel.node_value=o()(r),console.log("更新后的节点数据",t.state.drawerModel),t.props.onSubmit(t.state.drawerModel)}else N.ZP.warn("请选择指定成员或者添加指定上级")},t.onTitleBlur=function(){t.setState({titleEditable:!1})},t.onTitleEdit=function(){t.setState({titleEditable:!0},(function(){t.inputRef.current.focus()}))},t.onCloseDrawer=function(){t.props.onCloseDrawer()},t.closeMember=function(){t.setState({memberSelectorVisible:!1})},t.memberSelectorCallback=function(e){var n=t.state.config;e.length>20?N.ZP.warn("最多可添加20个成员"):(n.users=e.map((function(e){return{type:e.type,uid:e.id.toString(),uname:"string"==typeof e.name?e.name:e.name.props.children}})),t.setState({config:n,memberSelectorVisible:!1}))},t.onTitleChange=function(e){t.state.drawerModel.node_name=e.target.value,t.setState({drawerModel:t.state.drawerModel})},t.showMemberSelector=function(){t.setState({memberSelectorVisible:!0}),t.editMemberRef.current.wrappedInstance.setCheck((t.state.config.users||[]).filter((function(e){return!e.leave})))},t.addSuperior=function(){var e=t.state.config.cc_superiors,n=void 0===e?[]:e;n.push({level_num:"1"}),t.state.config.cc_superiors=n,t.setState({config:t.state.config})},t.onSuperiorTypeChange=function(e,n){var a=t.state.config.cc_superiors,r=void 0===a?[]:a;r[n].level_num=e,t.state.config.cc_superiors=r,t.setState({config:t.state.config})},t.deleteCondition=function(e){var n=t.state.config.cc_superiors,a=void 0===n?[]:n;a.splice(e,1),t.state.config.cc_superiors=a,t.setState({config:t.state.config})},t.onDeleteMember=function(e){t.state.config.users.splice(e,1),t.setState({config:t.state.config})},t.initData=function(){if(t.state.drawerModel.node_value){var e=JSON.parse(t.state.drawerModel.node_value);if(console.log("初始化抽屉数据",e),e.level_num){var n=e.level_num.split(","),a=[];n.forEach((function(e){a.push({level_num:e})})),e.cc_superiors=a}t.setState({config:e})}},t.state={drawerModel:(0,y.p$)(t.props.drawerData),titleEditable:!1,treeData:[],config:{}},t}return m()(l,[{key:"componentDidMount",value:function(){this.initData()}},{key:"render",value:function(){var e=this,t=this.state,n=t.titleEditable,a=t.drawerModel,r=(t.treeData,t.memberSelectorVisible,t.config);return E.createElement("div",{style:{height:"100vh",position:"relative"}},E.createElement("div",{className:"drawer-header"},E.createElement(b.Z,{visible:!n},E.createElement("span",{className:"edit-title"},a.node_name),E.createElement("span",{className:"edit-icon",onClick:this.onTitleEdit,style:{marginLeft:10}})),E.createElement(b.Z,{visible:n},E.createElement(_.Z,{maxLength:20,value:a.node_name,ref:this.inputRef,onChange:this.onTitleChange,onBlur:this.onTitleBlur,style:{width:300}}))),E.createElement("div",{className:"drawer-content-wrapper"},E.createElement("h1",{className:"drawer-title"},"指定成员：",E.createElement("span",{className:"sub-title"},"（可抄送成员）")),E.createElement(b.Z,{visible:r.users&&r.users.length>0},E.createElement(Z.default,{showSelector:this.showMemberSelector,onDelete:this.onDeleteMember,members:r.users})),E.createElement(w.Z,{onClick:this.showMemberSelector,type:"primary",className:"drawer-add-notify-member"},E.createElement(C.Z,{className:"drawer-add-member-icon"})," 添加"),E.createElement("h1",{className:"drawer-title"},"指定上级：",E.createElement("span",{className:"sub-title"},"（可抄送指定层级上单）")),r.cc_superiors&&r.cc_superiors.map((function(t,n){return E.createElement("div",{key:n,className:"notify-drawer-appoint-superiors"},E.createElement(g.Z,{value:t.level_num||"1",onChange:function(t){e.onSuperiorTypeChange(t,n)}},S.w9.map((function(e){return E.createElement(k,{key:e.value,value:e.value},e.label)}))),E.createElement("span",{className:"condition-edit-close",onClick:function(){e.deleteCondition(n)}}))})),E.createElement(w.Z,{onClick:this.addSuperior,type:"primary",className:"drawer-add-notify-condition"},E.createElement(C.Z,null)," 添加上级")),E.createElement("div",{className:"button-bar"},E.createElement(w.Z,{type:"primary",onClick:function(){e.submit()}},"确定"),E.createElement(w.Z,{onClick:this.onCloseDrawer},"取消")))}}]),l}(E.Component)},29396:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>z});var a=n(58548),r=n.n(a),l=n(78829),o=n.n(l),i=n(51765),s=n.n(i),c=n(93287),m=n.n(c),u=n(24309),d=n.n(u),p=n(33929),v=n.n(p),f=n(63497),h=n.n(f),E=n(69984),y=n.n(E),b=n(74720),g=n.n(b),N=n(9830),_=n.n(N),w=n(30695),Z=n.n(w),C=n(83507),S=n.n(C),k=n(69024),D=n.n(k),M=n(600),x=n.n(M),P=n(67294),R=n(41584),T=n(34046),V=n(48086),F=n(14617),B=n(47933),L=n(9676),O=n(71577),q=n(49101),W=n(88675),A=n(23148),j=n(85907),G=n(45724);function H(e,t){var n=v()(e);if(d()){var a=d()(e);t&&(a=a.filter((function(t){return m()(e,t).enumerable}))),n.push.apply(n,a)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){y()(e,t,n[t])})):s()?o()(e,s()(n)):H(Object(n)).forEach((function(t){r()(e,t,m()(n,t))}))}return e}var z=function(e){S()(r,e);var t,n,a=(t=r,n=function(){if("undefined"==typeof Reflect||!h())return!1;if(h().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(h()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=x()(t);if(n){var r=x()(this).constructor;e=h()(a,arguments,r)}else e=a.apply(this,arguments);return D()(this,e)});function r(e){var t;return _()(this,r),(t=a.call(this,e)).inputRef=(0,P.createRef)(),t.editMemberRef=(0,P.createRef)(),t.submit=function(){var e=t.state.config,n=e.user_type,a=e.roles,r=e.if_empty,l=t.state.users;if(l=l&&l.filter((function(e){return!e.leave})),3!==n||l&&0!=l.length)if(n!==G.MZ||a&&0!=a.length)if(n===G.MZ&&a.some((function(e){return e.is_empty})))V.ZP.warn("用户组为空，请添加用户组");else if(n===G.MZ&&a.some((function(e){return e.is_del})))V.ZP.warn("用户组为空，请添加用户组");else{var o={};switch(n){case 1:if(t.state.checkedList.length==t.state.paymentMembers.length)o.users=null,o.user_type=1;else{var i=t.state.paymentMembers.filter((function(e){return t.state.checkedList.some((function(t){return t==e.uid&&!e.leave}))}));if(0==i.length)return void V.ZP.warn("请选择指定审核人");o.users=i,o.user_type=2}break;case 3:o.users=l,o.user_type=3;break;case G.MZ:o.user_type=G.MZ,o.if_empty=r,o.roles=a.map((function(e){return{rid:e.role_id,rname:e.role_name}}))}o.pay_status=t.state.config.pay_status,t.state.drawerModel.node_value=g()(o),console.log("更新后的节点数据",t.state.drawerModel),t.props.onSubmit(t.state.drawerModel)}else V.ZP.warn("请选择指定用户组");else V.ZP.warn("请选择指定人员")},t.onTitleBlur=function(){t.setState({titleEditable:!1})},t.onRadioChange=function(e,n){var a=[];1==e.target.value&&(a=t.state.paymentMembers.map((function(e){return e.uid}))),t.state.config[n]=e.target.value,t.setState({config:t.state.config,checkedList:a})},t.onTitleEdit=function(){t.setState({titleEditable:!0},(function(){t.inputRef.current.focus()}))},t.onCloseDrawer=function(){t.props.onCloseDrawer()},t.onTitleChange=function(e){t.state.drawerModel.node_name=e.target.value,t.setState({drawerModel:t.state.drawerModel})},t.showMemberSelector=function(){t.setState({memberSelectorVisible:!0}),t.editMemberRef.current.wrappedInstance.setCheck((t.state.users||[]).filter((function(e){return!e.leave})))},t.onDeleteMember=function(e){t.state.users.splice(e,1),t.setState({users:t.state.users})},t.closeMember=function(){t.setState({memberSelectorVisible:!1})},t.onCheckboxGroupChange=function(e){t.setState({checkedList:e})},t.memberSelectorCallback=function(e){var n=t.state.users;e.length>20?V.ZP.warn("最多可添加20个成员"):(n=e.map((function(e){return{uid:e.id.toString(),uname:"string"==typeof e.name?e.name:e.name.props.children}})),t.setState({users:n,memberSelectorVisible:!1}))},t.onDeleteRole=function(e){t.state.config.roles.splice(e,1),t.setState({config:t.state.config})},t.showRoleSelector=function(){t.setState({roleSelectorVisible:!0})},t.onHideRolePicker=function(){t.setState({roleSelectorVisible:!1})},t.initData=function(){},t.state={drawerModel:(0,R.p$)(t.props.drawerData),titleEditable:!1,config:{},paymentMembers:[],treeData:[],memberSelectorVisible:!1,checkedList:[],users:[],roleData:[],roleSelectorVisible:!1},t}return Z()(r,[{key:"componentDidMount",value:function(){this.initData()}},{key:"render",value:function(){var e=this,t=this.state,n=t.titleEditable,a=t.drawerModel,r=t.config,l=t.paymentMembers,o=(t.treeData,t.memberSelectorVisible,t.checkedList),i=t.users,s=(t.roleSelectorVisible,[]);return r.roles&&(s=r.roles.map((function(e){return I(I({},e),{},{key:e.role_id,title:e.role_name,uname:e.role_name})}))),P.createElement("div",{style:{height:"100vh",position:"relative"}},P.createElement("div",{className:"drawer-header"},P.createElement(T.Z,{visible:!n},P.createElement("span",{className:"edit-title"},a.node_name),P.createElement("span",{className:"edit-icon",onClick:this.onTitleEdit,style:{marginLeft:10}})),P.createElement(T.Z,{visible:n},P.createElement(F.Z,{maxLength:20,value:a.node_name,ref:this.inputRef,onChange:this.onTitleChange,onBlur:this.onTitleBlur,style:{width:300}}))),P.createElement("div",{className:"drawer-content-wrapper"},P.createElement("h1",{className:"drawer-title"},"设置审核人"),P.createElement(B.ZP.Group,{name:"radiogroup",className:"approval-type-radio-group",onChange:function(t){e.onRadioChange(t,"user_type")},value:r.user_type},P.createElement(B.ZP,{className:"approval-type-radio",value:1},"全部出纳人员"),P.createElement(B.ZP,{className:"approval-type-radio",value:3},"指定成员"),P.createElement(B.ZP,{className:"approval-type-radio",value:G.MZ},"指定用户组",P.createElement(A.default,null))),P.createElement(T.Z,{visible:1==r.user_type&&l&&0==l.length},P.createElement("div",{className:"setting-member-tips"},P.createElement("span",{className:"icon"}),P.createElement("span",{className:"text"},"未设置出纳权限人员，请先前往"),P.createElement("span",{className:"highlight-text"},"【企业设置-权限管理】"),P.createElement("span",{className:"text"},"中设置"))),P.createElement(T.Z,{visible:1==r.user_type&&l&&l.length>0},P.createElement("div",null,P.createElement(L.Z.Group,{onChange:this.onCheckboxGroupChange,value:o},l.map((function(e){return P.createElement(L.Z,{value:e.uid,key:e.uid,className:e.leave?"quit":""},e.uname+(e.leave?"(已离职)":""))}))))),P.createElement(T.Z,{visible:3==r.user_type},P.createElement("h1",{className:"drawer-title"},"添加成员：",P.createElement("span",{className:"sub-title"},"（不超过20个）")),P.createElement(T.Z,{visible:i&&i.length>0},P.createElement(j.default,{showSelector:this.showMemberSelector,onDelete:this.onDeleteMember,members:i})),P.createElement(O.Z,{onClick:this.showMemberSelector,type:"primary",className:"drawer-add-member"},P.createElement(q.Z,{className:"drawer-add-member-icon"})," 添加指定成员")),P.createElement(T.Z,{visible:r.user_type==G.MZ},P.createElement("h1",{className:"drawer-title"},"添加用户组：",P.createElement("span",{className:"sub-title"},"（单选）")),P.createElement(T.Z,{visible:r.roles&&r.roles.length>0},P.createElement(j.default,{showSelector:this.showRoleSelector,onDelete:this.onDeleteRole,members:s})),P.createElement(O.Z,{onClick:this.showRoleSelector,type:"primary",className:"drawer-add-member"},P.createElement(q.Z,{className:"drawer-add-member-icon"})," 添加用户组")),P.createElement(T.Z,{visible:r.user_type==G.MZ},P.createElement("h1",{className:"drawer-title approval-type-title"},"审批人为空时候："),P.createElement(B.ZP.Group,{name:"radiogroup",onChange:function(t){e.onRadioChange(t,"if_empty")},value:(0,R.xb)(r.if_empty)?1:r.if_empty},P.createElement(B.ZP,{value:1},"自动转交管理员",P.createElement(W.Z,null,"当用户组或主管为空时，审批单会自动转交给超级管理员"))))),P.createElement("div",{className:"button-bar"},P.createElement(O.Z,{type:"primary",onClick:function(){e.submit()}},"确定"),P.createElement(O.Z,{onClick:this.onCloseDrawer},"取消")))}}]),r}(P.Component)},23148:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>D});var a=n(63497),r=n.n(a),l=n(9830),o=n.n(l),i=n(30695),s=n.n(i),c=n(83507),m=n.n(c),u=n(69024),d=n.n(u),p=n(600),v=n.n(p),f=n(67294),h=n(57016),E=n(71577),y=n(16550),b=n(71649),g=n.n(b),N=n(11845),_=n.n(N),w=n(19181),Z=n(80411),C=n.n(Z);var S,k=function(e){m()(l,e);var t,n,a=(t=l,n=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(r()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=v()(t);if(n){var l=v()(this).constructor;e=r()(a,arguments,l)}else e=a.apply(this,arguments);return d()(this,e)});function l(){return o()(this,l),a.apply(this,arguments)}return s()(l,[{key:"render",value:function(){var e=this.props,t=(e.content,e.minHgWid),n=void 0===t?20:t,a=e.children,r=e.bgOpacity,l=void 0!==r&&r,o=_()(e,["content","minHgWid","children","bgOpacity"]),i=f.createElement("div",{className:"hover-tips-content"},a);return f.createElement(w.Z,g()({content:i,className:"hover-tips-popover"},o),f.createElement("div",{id:"hover-popover",className:C()({"bg-opacity":l}),style:{minHeight:n,minWidth:n}}))}}]),l}(f.Component);const D=(0,y.EN)(S=function(e){m()(l,e);var t,n,a=(t=l,n=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(r()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=v()(t);if(n){var l=v()(this).constructor;e=r()(a,arguments,l)}else e=a.apply(this,arguments);return d()(this,e)});function l(){var e;o()(this,l);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=a.call.apply(a,[this].concat(n))).linkRolePage=function(){h.Z.confirm({title:"提示",content:"设置用户组不会保存当前审批流，确认要去设置用户组吗",cancelText:"取消",okText:"去设置",zIndex:2e3,onOk:function(){e.props.history.replace("/company/roles/index")}})},e}return s()(l,[{key:"render",value:function(){return f.createElement(k,{placement:"bottomRight"},f.createElement("div",{className:"role-popover-container"},f.createElement("h1",{className:"role-popover-title"},"适用场景："),f.createElement("img",{className:"role-desc-img",src:"https://apg-1258944054.cos.ap-guangzhou.myqcloud.com/apg/pc-micro-reimburse/apply-flow/role_popover.png",alt:""}),f.createElement("h1",{className:"role-popover-title"},"用户组定义："),f.createElement("p",{className:"role-popover-content"},"将很多有相同审批职能的人设置为同一用户组，并将这个用户组添加为审批人，如部门总监"),f.createElement("h1",{className:"role-popover-title"},"用户组的管理范围："),f.createElement("p",{className:"role-popover-content"},"可以给用户组里的每成员指定管理的部门，这些部门的员工提交的单据就由该成员审批，默认管理所有人。"),f.createElement("h1",{className:"role-popover-title"},"如何设置："),f.createElement("div",{className:"role-popover-steps"},f.createElement("div",{className:"role-popover-step"},f.createElement("span",{className:"icon"},"1"),f.createElement("span",{className:"desc"},"进入组织架构设置用户组"),f.createElement("span",{className:"arrow"},f.createElement("img",{src:"https://apg-1258944054.cos.ap-guangzhou.myqcloud.com/apg/pc-micro-reimburse/apply-flow/role-popover-arrow.png",alt:""}))),f.createElement("div",{className:"role-popover-step"},f.createElement("span",{className:"icon"},"2"),f.createElement("span",{className:"desc"},"设置用户组的管理范围"),f.createElement("span",{className:"arrow"},f.createElement("img",{src:"https://apg-1258944054.cos.ap-guangzhou.myqcloud.com/apg/pc-micro-reimburse/apply-flow/role-popover-arrow.png",alt:""}))),f.createElement("div",{className:"role-popover-step"},f.createElement("span",{className:"icon"},"3"),f.createElement("span",{className:"desc"},"审批流里使用用户组"))),f.createElement(E.Z,{className:"set-role-btn",onClick:this.linkRolePage},"设置用户组")))}}]),l}(f.Component))||S},99477:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>oe});var a=n(63497),r=n.n(a),l=n(23010),o=n.n(l),i=n(74720),s=n.n(i),c=n(48550),m=n.n(c),u=n(9830),d=n.n(u),p=n(30695),v=n.n(p),f=n(83507),h=n.n(f),E=n(69024),y=n.n(E),b=n(600),g=n.n(b),N=n(67294),_=n(80411),w=n.n(_),Z=n(34046),C=n(48086),S=n(19181),k=n(59314),D=n(31097),M=n(57016),x=n(14617),P=n(71577),R=n(83107),T=n(54549),V=n(45724),F=n(41584),B=(0,F.qW)(V.zH),L=(0,F.qW)(V.ve),O=(0,F.qW)(V.J_),q=(0,F.qW)(V.S_),W=(0,F.qW)(V.w9),A=(0,F.qW)(V.LI),j=function(e){e=e||32;for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=t.length,a="",r=0;r<e;r++)a+=t.charAt(Math.floor(Math.random()*n));return a},G=function e(t){for(var n=0;n<t.length;){var a=t[n],r=a.lineNodes;a.node_type===V.KT&&r&&r.length>0?(r.forEach((function(e,t){t<9&&e.node_option&&(e.node_option.includes("0")||(e.node_option="优先级0".concat(t+1))),e.node_seq=n})),t.splice.apply(t,[n,1].concat(o()(e(r))))):a.node_type!=V.dA&&(a.node_seq=n),a.child_nodes&&a.child_nodes.length>0&&e(a.child_nodes),n++}return t},H=function(e){e.forEach((function(e,t){e.node_option="优先级".concat(t+1)}))},I=function(e){var t=[];return function e(n){var a=n.some((function(e){return e.node_type==V.ux})),r=n.some((function(e){return e.node_type==V.Oh})),l=n.some((function(e){return e.node_type==V.PC})),o=n.findIndex((function(e){return e.node_type==V.KT}));a&&t.push(V.ux),r&&t.push(V.Oh),l&&t.push(V.PC),o>=0&&n[o].lineNodes.forEach((function(t){e(t.child_nodes)}))}(e),t},z=function e(t){var n=!1;return t.some((function(t){return t.node_type===V.KT?(t.lineNodes.forEach((function(t){n=e(t.child_nodes)})),n):t.node_type===V.PC}))},J=function(e){var t=!1;return e.findIndex((function(e){return e.node_type===V.KT?(e.lineNodes.forEach((function(e){t=z(e.child_nodes)})),t):e.node_type===V.PC}))},Q=n(24457),K=n(26676),$=n(40663),Y=n(29396),U=n(75238),X=n(67724),ee=n(80129),te=n.n(ee);function ne(e,t,n,a){var r,l=0;function o(){var o=this,i=Number(new Date)-l,s=arguments;function c(){l=Number(new Date),n.apply(o,s)}function m(){r=void 0}a&&!r&&c(),r&&clearTimeout(r),void 0===a&&i>e?c():!0!==t&&(r=setTimeout(a?m:c,void 0===a?e-i:e))}return"boolean"!=typeof t&&(a=n,n=t,t=void 0),o.cancel=function(){clearTimeout(r)},o}var ae={},re={},le=function(e,t,n){if(""===e||null==e)return"";var a=t.find((function(t){return t.value==e&&t.template_types.includes(Number(n))}));return a?a.label:e},oe=function(e){h()(l,e);var t,n,a=(t=l,n=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(r()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=g()(t);if(n){var l=g()(this).constructor;e=r()(a,arguments,l)}else e=a.apply(this,arguments);return y()(this,e)});function l(e){var t,n;return d()(this,l),(t=a.call(this,e)).tempTitleRef=(0,N.createRef)(),t.initData=function(){var e,n,a=te().parse(location.search,{ignoreQueryPrefix:!0}),r=a.template_name,l=void 0===r?"":r,o=(a.template_id,a.template_type),i=a.doc_tmpl_type;switch(+i){case 2:e=1;break;default:e=2}n=1==e?[{node_type:V.WD,key:j()},(0,V.yl)(2),{node_type:V.xV,key:j()}]:[{node_type:V.WD,key:j()},(0,V.yl)(2),(0,V.du)(),(0,V.ok)(),{node_type:V.xV,key:j()}],t.setState({approvalFlowData:n,template_name:decodeURIComponent(l),template_type:o,doc_tmpl_type:i,template:e})},t.onSaveTemp=function(){t.setState({submitLoading:!0});var e=function(e){var n=e.node_value&&JSON.parse(e.node_value)||{};if(n.users&&t.haddleQuit(n.users))return!1;if(n.roles&&t.haddleRoleStatus(n.roles))return!1;if(e.node_type===V.ux&&3==n.user_type&&(!n.users||0==n.users.length))return!1;if(!(e.node_type!==V.Oh&&e.node_type!==V.PC||3!=n.user_type||n.users&&0!=n.users.length))return!1;if(e.node_type===V.dA){if(!(n.conditions&&0!=n.conditions.length||e.default))return!1;for(var a=n.conditions,r=void 0===a?[]:a,l=!0,o=0;o<r.length;o++)if(r[o].type===V.Bv)for(var i=r[o].value.split(","),s=0;s<i.length;s++){var c=i[s].split("#"),u=m()(c,3);if(u[0],u[1],"true"===u[2]){l=!1;break}}if(!l)return l}return!!(e.node_type!==V.k0||n.users&&0!=n.users.length||n.level_num)},n=G((0,F.p$)(t.state.approvalFlowData));if(!function t(n){for(var a=!0,r=0;r<n.length&&(a=e(n[r]))&&(n[r].node_type==V.dA&&(a=t(n[r].child_nodes)),a);r++);return a}(n))return t.setState({submitLoading:!1}),void C.ZP.warn("存在节点信息配置不完整，详见流程图警告提示");t.state.template_id,t.state.template_name,t.state.template_type,n.slice(1,-1),C.ZP.success("保存成功"),t.goBack()},t.generateNodeContainer=function(e){return e&&e.map((function(n,a){switch(n.node_type){case V.WD:case V.xV:return t.generateApplicantNode(n,a,e);case V.Oh:return t.generateFinancialNode(n,a,e);case V.PC:return t.generatePaymentNode(n,a,e);case V.ux:return t.generateApprovalNode(n,a,e);case V.k0:return t.generateNotifyNode(n,a,e);case V.KT:return t.generateRouteNode(n,a,e)}}))},t.generateApplicantNode=function(e,n,a){return N.createElement("div",{className:"node-container",key:e.key},N.createElement("div",null,N.createElement("div",{className:"node-box-start"},N.createElement(Z.Z,{visible:e.node_type!=V.xV},N.createElement("div",{className:"content"},"开始")),N.createElement(Z.Z,{visible:e.node_type==V.xV},N.createElement("div",{className:"content"},"结束")))),N.createElement(Z.Z,{visible:e.node_type!=V.xV},N.createElement("div",{className:"add-node-btn-box"},N.createElement("div",{className:"add-node-btn"},N.createElement(S.Z,{placement:"right",content:t.generateCreateNodeBtns(e.node_type,n,a)},N.createElement("div",{className:"btn"}))))))},t.generateSelectorNode=function(e,n,a,r){var l,o={};return e.node_value&&(l=JSON.parse(e.node_value).conditions),l&&(o=t.generateConditionTemp(l,Number(t.state.doc_tmpl_type))),N.createElement("div",{className:"node-container",key:e.key},N.createElement("div",{className:"node-condition"},N.createElement("div",{className:w()("node-box","node-box-condition"),onClick:function(n){t.showDrawer(n,e,r)}},N.createElement("div",{className:"line-end-arrow"}),o.isHaveQuit&&t.generateCreateWarning("人员离职或用户组删除"),N.createElement("div",{className:"title"},N.createElement("span",{className:"title-text"},e.node_name),N.createElement("span",{className:"node-priority"},e.node_option),N.createElement(Z.Z,{visible:!e.default},N.createElement("span",{className:"node-title-operate"},N.createElement(T.Z,{onClick:function(e){t.deleteCondition(e,r)}})))),N.createElement("div",{className:w()("content",{"defaul-condition":e.default})},N.createElement(Z.Z,{visible:!l&&!e.default},N.createElement("div",{className:"no-condition"},N.createElement("span",null),"请设置条件")),N.createElement(Z.Z,{visible:!l&&e.default},"未满足其他条件分支的情况，将使用默认流程"),N.createElement(Z.Z,{visible:l},N.createElement("div",{className:"condition-line",key:"title"},"需同时满足以下条件："),o.conditionsNode)))),N.createElement("div",{className:"add-node-btn-box"},N.createElement("div",{className:"add-node-btn"},N.createElement(S.Z,{placement:"right",content:t.generateCreateNodeBtns(e.node_type,n,a)},N.createElement("div",{className:"btn"})))))},t.generateApprovalNode=function(e,n,a){var r=JSON.parse(e.node_value),l=t.haddleMembers(r.users),o=l.isHaveQuit,i=l.members,s=t.haddleRoles(r.roles),c=s.isEmpty,m=s.isDel,u=s.tooltip,d=s.roles;return N.createElement("div",{className:"node-container",key:e.key},N.createElement("div",{className:w()("node-box","node-box-approval"),onClick:function(n){t.showDrawer(n,e)}},N.createElement("div",{className:"line-end-arrow"}),o&&t.generateCreateWarning("审批人已离职"),(c||m)&&t.generateCreateWarning(u),N.createElement("div",{className:"title"},N.createElement("span",{className:"title-text"},e.node_name),N.createElement("span",{className:"node-title-operate"},N.createElement(T.Z,{style:{color:"#898c96"},onClick:function(e){t.deleteNode(e,n,a)}}))),N.createElement(Z.Z,{visible:r.user_type==V.Dw},N.createElement("div",{className:"content"},W(r.level_num))),N.createElement(Z.Z,{visible:r.user_type==V.d},N.createElement(Z.Z,{visible:i&&i.length>0},N.createElement("span",{className:"content"},N.createElement("div",{className:"condition-line"},"指定成员：",i&&i))),N.createElement(Z.Z,{visible:!i||0==i.length},N.createElement("span",{className:"content no-condition"},N.createElement("span",null),"请指定审批人"))),N.createElement(Z.Z,{visible:r.user_type==V.MZ},N.createElement(Z.Z,{visible:d&&d.length>0},N.createElement("span",{className:"content"},N.createElement("div",{className:"condition-line"},"指定用户组：",d&&d)))),N.createElement(Z.Z,{visible:r.user_type==V.EN},N.createElement(Z.Z,{visible:1==r.level_type},N.createElement("div",{className:"content"},"从直接主管到发起人向上的",W(r.level_num))),N.createElement(Z.Z,{visible:2==r.level_type},N.createElement("div",{className:"content"},"从直接主管到通讯录级别最高的",A(r.level_num))))),N.createElement("div",{className:"add-node-btn-box"},N.createElement("div",{className:"add-node-btn"},N.createElement(S.Z,{placement:"right",content:t.generateCreateNodeBtns(e.node_type,n,a)},N.createElement("div",{className:"btn"})))))},t.generateFinancialNode=function(e,n,a){var r=JSON.parse(e.node_value),l=t.haddleMembers(r.users),o=l.isHaveQuit,i=l.members,s=t.haddleRoles(r.roles),c=s.isEmpty,m=s.isDel,u=s.tooltip,d=s.roles;return N.createElement("div",{className:"node-container",key:e.key},N.createElement("div",{className:w()("node-box","node-box-financial"),onClick:function(n){t.showDrawer(n,e)}},N.createElement("div",{className:"line-end-arrow"}),o&&t.generateCreateWarning("审核人已离职"),(c||m)&&t.generateCreateWarning(u),N.createElement("div",{className:"title"},N.createElement("span",{className:"title-text"},e.node_name)),N.createElement(Z.Z,{visible:1==r.user_type},N.createElement("span",{className:"content"},N.createElement("div",{className:"condition-line"},"全部审单会计"))),N.createElement(Z.Z,{visible:2==r.user_type&&i&&i.length>0},N.createElement("span",{className:"content"},N.createElement("div",{className:"condition-line"},"审单会计：",i&&i))),N.createElement(Z.Z,{visible:3==r.user_type&&i&&i.length>0},N.createElement("span",{className:"content"},N.createElement("div",{className:"condition-line"},"指定成员：",i&&i))),N.createElement(Z.Z,{visible:r.user_type==V.MZ},N.createElement(Z.Z,{visible:d&&d.length>0},N.createElement("span",{className:"content"},N.createElement("div",{className:"condition-line"},"指定用户组：",d&&d))))),N.createElement("div",{className:"add-node-btn-box"},N.createElement("div",{className:"add-node-btn"},N.createElement(S.Z,{placement:"right",content:t.generateCreateNodeBtns(e.node_type,n,a)},N.createElement("div",{className:"btn"})))))},t.generateNotifyNode=function(e,n,a){var r=JSON.parse(e.node_value),l=t.haddleMembers(r.users),o=l.isHaveQuit,i=l.members,s=r.level_num&&r.level_num.split(",").map((function(e){return W(e)}));return N.createElement("div",{className:"node-container",key:e.key},N.createElement("div",{className:w()("node-box","node-box-notify"),onClick:function(n){t.showDrawer(n,e)}},N.createElement("div",{className:"line-end-arrow"}),o&&t.generateCreateWarning("抄送人已离职"),N.createElement("div",{className:"title"},N.createElement("span",{className:"title-text"},e.node_name),N.createElement("span",{className:"node-title-operate"},N.createElement(T.Z,{style:{color:"#898c96"},onClick:function(e){t.deleteNode(e,n,a)}}))),N.createElement(Z.Z,{visible:!(i&&0!=i.length||s&&0!=s.length)},N.createElement("span",{className:"content no-condition"},N.createElement("span",null),"请指定抄送人")),N.createElement(Z.Z,{visible:i&&i.length>0||s&&s.length>0},N.createElement("div",{className:"content"},N.createElement("div",{className:"condition-line"},"指定成员：",i&&i,i&&s&&",",s&&s.join(","))))),N.createElement("div",{className:"add-node-btn-box"},N.createElement("div",{className:"add-node-btn"},N.createElement(S.Z,{placement:"right",content:t.generateCreateNodeBtns(e.node_type,n,a)},N.createElement("div",{className:"btn"})))))},t.generatePaymentNode=function(e,n,a){var r=JSON.parse(e.node_value),l=t.haddleMembers(r.users),o=l.isHaveQuit,i=l.members,c=t.haddleRoles(r.roles),m=c.isEmpty,u=c.isDel,d=c.tooltip,p=c.roles;return N.createElement("div",{className:"node-container",key:e.key},N.createElement("div",{className:w()("node-box","node-box-payment"),onClick:function(n){t.showDrawer(n,e)}},N.createElement("div",{className:"line-end-arrow"}),o&&t.generateCreateWarning("结算人已离职"),(m||u)&&t.generateCreateWarning(d),N.createElement("div",{className:"title"},N.createElement("span",{className:"title-text"},e.node_name),N.createElement("span",{className:"node-switch"},N.createElement(k.Z,{size:"small",onChange:function(n,a){!function(e,n,a){var r=JSON.parse(a.node_value);n&&n.preventDefault(),n&&n.stopPropagation(),r.pay_status=e?1:2,a.node_value=s()(r),t.setState({approvalFlowData:t.state.approvalFlowData})}(n,a,e)},checked:1==r.pay_status}))),N.createElement(Z.Z,{visible:1==r.user_type},N.createElement("span",{className:"content"},N.createElement("div",{className:"condition-line"},"全部出纳"))),N.createElement(Z.Z,{visible:2==r.user_type&&i&&i.length>0},N.createElement("span",{className:"content"},"M",N.createElement("div",{className:"condition-line"},"出纳：",i&&i))),N.createElement(Z.Z,{visible:3==r.user_type&&i&&i.length>0},N.createElement("span",{className:"content"},N.createElement("div",{className:"condition-line"},"指定成员：",i&&i))),N.createElement(Z.Z,{visible:r.user_type==V.MZ},N.createElement(Z.Z,{visible:p&&p.length>0},N.createElement("span",{className:"content"},N.createElement("div",{className:"condition-line"},"指定用户组：",p&&p))))),N.createElement("div",{className:"add-node-btn-box"},N.createElement("div",{className:"add-node-btn"},N.createElement(S.Z,{placement:"right",content:t.generateCreateNodeBtns(e.node_type,n,a)},N.createElement("div",{className:"btn"})))))},t.generateCreateWarning=function(e){return N.createElement(D.Z,{placement:"top",title:e},N.createElement("div",{className:"node-box-warning"},N.createElement("img",{src:"https://apg-1258944054.cos.ap-guangzhou.myqcloud.com/apg/pc-micro-reimburse/common/%21.svg",alt:""})))},t.haddleRoles=function(e){var t=!1,n=!1,a="";return{roles:e&&e.map((function(e,r){var l="";return e.is_del&&(n=!0,l="quit",a="用户组已删除"),e.is_empty&&(t=!0,l="quit",a="用户组无成员"),N.createElement("span",{className:l,key:"members"+e.rid},"".concat(e.rname).concat(e.is_empty?"(无成员)":"").concat(e.is_del?"(已删除)":""))})),isEmpty:t,isDel:n,tooltip:a}},t.generateConditionTemp=function(e,n){var a=t.state.conditionLabelMap,r=(0,F.qW)([],"已删除");if(!e)return null;var l=!1,o=e.map((function(e,t){switch(e.type){case V.l9:var o=e.value&&e.value.split(",").map((function(e){var t=e.split("#"),n=m()(t,3),a=n[0],r=n[1],o="";return n[2]&&(l=!0,o="quit",r+="(已离职)"),N.createElement("span",{className:o,key:"members"+a},r)}));return N.createElement("div",{className:"condition-line conditions",key:t},a.commiter||q(V.l9),": ",B(e.compare)," ",o);case V.Bv:var i=e.value&&e.value.split(",").map((function(e){var t=e.split("#"),n=m()(t,3),a=n[0],r=n[1],o=n[2],i="";return o&&"true"===o&&(l=!0,i="quit",r+="(已删除)"),N.createElement("span",{className:i,key:"members"+a},r)}));return N.createElement("div",{className:"condition-line conditions",key:t},q(V.Bv),": ",B(e.compare)," ",i);case V.Fr:var s=e.value&&e.value.split(",").map((function(e){var t=e.split("#"),n=m()(t,2);return n[0],n[1]}));return N.createElement("div",{className:"condition-line conditions",key:t},a.department||q(V.Fr),": ",B(e.compare)," ",s.join(","));case V.Al:var c=e.value&&e.value.split(",").map((function(e){var t=e.split("#"),n=m()(t,2);return n[0],n[1]}));return N.createElement("div",{className:"condition-line conditions",key:t},a.title||q(V.Al),": ",B(e.compare)," ",c.join(","));case V.lt:var u=e.value&&e.value.split(",").map((function(e){var t=e.split("#"),n=m()(t,2);return n[0],n[1]}));return N.createElement("div",{className:"condition-line conditions",key:t},q(V.lt),": ",L(e.compare)," ",u.join(","));case V.w7:var d=e.value&&e.value.split(",").map((function(e){return r(e)}));return N.createElement("div",{className:"condition-line conditions",key:t},a.trans_way||q(V.w7),": ",L(e.compare)," ",d.join(","));case V.NY:var p=e.value&&e.value.split(",").map((function(e){return r(e)}));return N.createElement("div",{className:"condition-line conditions",key:t},a.travel_type||q(V.NY),": ",B(e.compare)," ",p.join(","));case V.l2:var v=e.value&&e.value.split(",").map((function(e){return e}));return N.createElement("div",{className:"condition-line conditions",key:t},q(V.l2),": ",B(e.compare)," ",v.join(","));case V.j4:var f=e.value&&e.value.split(","),h=m()(f,2),E=h[0],y=h[1];return N.createElement("div",{className:"condition-line conditions",key:t},le(e.type,V.S_,n),": ",O(e.compare),+E,y&&" - ".concat(+y),"小时");case V.Bc:var b=e.value&&e.value.split(","),g=m()(b,2),_=g[0],w=g[1];return N.createElement("div",{className:"condition-line conditions",key:t},a.amount||le(e.type,V.S_,n),": ",O(e.compare),(+_).div(100),w&&"-".concat((+w).div(100)))}}));return{isHaveQuit:l,conditionsNode:o}},t.generateCreateNodeBtns=function(e,n,a){var r=function e(t){for(var a=t.slice(0,n+1),r=!1,l=0;l<a.length;l++){var o=a[l];if(o.node_type===V.KT&&o.lineNodes.forEach((function(t){r=e(t.child_nodes)})),o.node_type===V.PC){r=!0;break}}return r};return N.createElement("div",{className:"add-button-container"},N.createElement(Z.Z,{visible:!r(a)},N.createElement("div",{className:"add-button-wrapper"},N.createElement("span",{className:"icon audit-icon",onClick:function(){t.onCreateNode(V.ux,n,a)}}),N.createElement("span",{style:{color:"#007AFF"},onClick:function(){t.onCreateNode(V.ux,n,a)}},"审批人"))),N.createElement("div",{className:"add-button-wrapper"},N.createElement("span",{className:"icon cc-icon",onClick:function(){t.onCreateNode(V.k0,n,a)}}),N.createElement("span",{style:{color:"#F8A209"},onClick:function(){t.onCreateNode(V.k0,n,a)}},"抄送人")),N.createElement(Z.Z,{visible:function(t){return e===V.dA||t[n+1]&&t[n+1].node_type!=V.xV&&!r(t)}(a)},N.createElement("div",{className:"add-button-wrapper"},N.createElement("span",{className:"icon condition-icon",onClick:function(){t.onCreateNode(V.KT,n,a)}}),N.createElement("span",{style:{color:"#898C96"},onClick:function(){t.onCreateNode(V.KT,n,a)}},"条件"))))},t.deleteCondition=function(e,n){e.stopPropagation(),M.Z.confirm({content:"是否确认删除该条件？",title:"提示",onOk:function(){if(n.currentNodes.lineNodes.length>2)n.currentNodes.lineNodes.splice(n.index,1),H(n.currentNodes.lineNodes);else{var e,a=n.currentNodes.lineNodes[1].child_nodes,r=n.approvalFlowData.findIndex((function(e){return e.key==n.currentNodes.key}));(e=n.approvalFlowData).splice.apply(e,[r,1].concat(o()(a)))}t.setState({approvalFlowData:t.state.approvalFlowData})}})},t.deleteNode=function(e,n,a){e.stopPropagation(),M.Z.confirm({content:"是否确认删除该节点？",title:"提示",onOk:function(){a.splice(n,1),t.setState({approvalFlowData:t.state.approvalFlowData})}})},t.addConditionNode=function(e){if(e.length>98)C.ZP.warn("最多能添加99个条件");else{var n=[];e.forEach((function(e){n=[].concat(o()(n),o()(I(e.child_nodes)))}));var a=[];n.includes(V.ux)&&a.push((0,V.yl)()),n.includes(V.Oh)&&a.push((0,V.du)()),n.includes(V.PC)&&a.push((0,V.ok)()),e.splice(-1,0,(0,V.lf)(a,"条件".concat(e.length))),H(e),t.setState({approvalFlowData:t.state.approvalFlowData}),console.log(t.state.approvalFlowData)}},t.onCreateNode=function(e,n,a){var r=a[n],l=t.state.template;switch(e){case V.ux:r.node_type==V.dA?r.child_nodes.unshift((0,V.yl)()):a.splice(n+1,0,(0,V.yl)());break;case V.k0:r.node_type==V.dA?r.child_nodes.unshift((0,V.y5)()):a.splice(n+1,0,(0,V.y5)());break;case V.KT:var o,i=J(a),s=a[a.length-1];o=r.node_type==V.dA?r.child_nodes:n<i?n+1===i?a.slice(n+1,-1):a.slice(n+1,i):1==l?s.node_type==V.xV?a.slice(n+1,-1):a.slice(n+1):s.node_type==V.xV?a.slice(n+1,-2):a.slice(n+1);var c=[],m=I(o);m.includes(V.ux)&&c.push((0,V.yl)()),m.includes(V.Oh)&&c.push((0,V.du)()),m.includes(V.PC)&&c.push((0,V.ok)()),r.node_type==V.dA?r.child_nodes=[{node_type:e,key:j(),lineNodes:[(0,V.lf)(c),(0,V.lf)(o,"默认条件","优先级2",!0)]}]:a.splice(n+1,o.length,{node_type:e,key:j(),lineNodes:[(0,V.lf)(c),(0,V.lf)(o,"默认条件","优先级2",!0)]})}t.setState({approvalFlowData:t.state.approvalFlowData}),console.log(t.state.approvalFlowData)},t.onShowDrawer=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ae=e,n&&(re=n),e.default||t.setState({drawerVisible:!0})},t.showDrawer=function(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.onShowDrawer(n,a)},t.onCloseDrawer=function(){t.setState({drawerVisible:!1})},t.generateDrawerContent=function(){switch(ae.node_type){case V.ux:return N.createElement(Q.default,{drawerData:ae,onCloseDrawer:t.onCloseDrawer,onSubmit:t.onDrawerSubmit});case V.dA:return N.createElement(K.default,{drawerData:ae,onChangePriority:t.onChangePriority,lineNodesConfig:re,onCloseDrawer:t.onCloseDrawer,onSubmit:t.onDrawerSubmit,conditionLabelMap:t.state.conditionLabelMap});case V.Oh:return N.createElement($.default,{drawerData:ae,onCloseDrawer:t.onCloseDrawer,onSubmit:t.onDrawerSubmit});case V.PC:return N.createElement(Y.default,{drawerData:ae,onCloseDrawer:t.onCloseDrawer,onSubmit:t.onDrawerSubmit});case V.k0:return N.createElement(U.default,{drawerData:ae,onCloseDrawer:t.onCloseDrawer,onSubmit:t.onDrawerSubmit})}},t.onChangePriority=function(e,n){console.log(re);var a=[re.currentNodes.lineNodes[n],re.currentNodes.lineNodes[e]];re.currentNodes.lineNodes[e]=a[0],re.currentNodes.lineNodes[n]=a[1],H(re.currentNodes.lineNodes),t.setState({approvalFlowData:t.state.approvalFlowData})},t.onDrawerSubmit=function(e){ae.node_value=e.node_value,ae.node_name=e.node_name,t.setState({approvalFlowData:t.state.approvalFlowData,drawerVisible:!1})},t.scaleContent=function(e){var n=t.state,a=n.scale,r=n.scaleStyle;if("-"==e){if(a<=.5)return;a=+(a-=.1).toFixed(1)}else{if(1==a)return;a=+(a+=.1).toFixed(1)}r={MsTransform:"scale(".concat(a,")"),MozTransform:"scale(".concat(a,")"),WebkitTransform:"scale(".concat(a,")"),transform:"scale(".concat(a,")")},t.setState({scale:a,scaleStyle:r})},t.setTempTitleEdit=function(){t.setState({tempTitleEdit:!0},(function(){t.tempTitleRef.current.focus()}))},t.onTempTitleChange=function(e){t.setState({template_name:e.target.value})},t.onTempTitleBlur=function(){t.setState({tempTitleEdit:!1})},t.onCancel=function(){M.Z.confirm({title:"提示",content:"取消后配置的内容将不会保存，确定取消吗？",onOk:function(){t.goBack()}})},t.afterVisibleChange=function(e){e?setTimeout((function(){document.querySelector("body").setAttribute("style","overflow-y: hidden; touch-action: none;")})):setTimeout((function(){document.querySelector("body").setAttribute("style","overflow-y: auto")}),0)},t.goBack=function(){sessionStorage.setItem("echo_selected_custom_doc_tmpl",s()({type:Number(t.state.template_type),currTab:"1"})),history.back()},t.state={approvalFlowData:[],drawerVisible:!1,approvalDrawerModel:{},tempTitleEdit:!1,titleEditable:!1,scaleStyle:null,scale:1,submitLoading:!1,template_name:null,template_id:null,template_type:null,doc_tmpl_type:null,conditions_quit:!1,conditionLabelMap:{},template:2},t.showDrawer=(300,!1,void 0===(n=t.showDrawer)?ne(300,false,!1):ne(300,n,!1)),t}return v()(l,[{key:"componentDidMount",value:function(){this.initData()}},{key:"generateRouteNode",value:function(e,t,n){var a=this;return N.createElement("div",{className:"node-container",key:e.key},N.createElement("div",{className:"branch-wrap"},N.createElement("div",{className:"branch-wrap-box"},N.createElement("div",{className:"branch-box"},N.createElement("div",{className:"add-branch",onClick:function(){a.addConditionNode(e.lineNodes)}},"添加条件"),e.lineNodes.map((function(t,r){return N.createElement("div",{className:"col-box",key:t.key},N.createElement(Z.Z,{visible:0==r},N.createElement("div",{className:"top-left-cover-line"}),N.createElement("div",{className:"bottom-left-cover-line"})),N.createElement(Z.Z,{visible:r==e.lineNodes.length-1},N.createElement("div",{className:"top-right-cover-line"}),N.createElement("div",{className:"bottom-right-cover-line"})),a.generateSelectorNode(t,r,e.lineNodes,{currentNodes:e,index:r,approvalFlowData:n}),a.generateNodeContainer(t.child_nodes))}))))),N.createElement("div",{className:"add-node-btn-box"},N.createElement("div",{className:"add-node-btn"},N.createElement(S.Z,{placement:"right",content:this.generateCreateNodeBtns(e.node_type,t,n)},N.createElement("div",{className:"btn"})))))}},{key:"haddleMembers",value:function(e){var t=!1;return{members:e&&e.map((function(e,n){var a="";return(e.leave||e.is_del||e.is_empty)&&(t=!0,a="quit"),N.createElement("span",{className:a,key:"members"+e.uid},"".concat(e.uname).concat(e.leave?"(已离职)":""))})),isHaveQuit:t}}},{key:"haddleQuit",value:function(e){var t=!1;return e&&e.map((function(e){e.leave&&(t=!0)})),t}},{key:"haddleRoleStatus",value:function(e){var t=!1;return e&&e.forEach((function(e){(e.is_empty||e.is_del)&&(t=!0)})),t}},{key:"render",value:function(){var e=this,t=this.state,n=t.tempTitleEdit,a=t.template_name,r=t.submitLoading;return N.createElement("div",{className:"approvalFlow_frame"},N.createElement("div",{className:"scale-bar"},N.createElement("span",{className:"ctrl-btn",onClick:function(){e.scaleContent("-")}},"-"),N.createElement("span",null,100*this.state.scale,"%"),N.createElement("span",{className:"ctrl-btn",onClick:function(){e.scaleContent("+")}},"+")),N.createElement("div",{className:"approvalFlow_header"},N.createElement("span",{className:"back",onClick:this.goBack},N.createElement(X.Z,null)),N.createElement("span",{className:"title"},N.createElement(Z.Z,{visible:!n},N.createElement("div",{className:"temp-title",onClick:this.setTempTitleEdit},N.createElement("span",{className:"text",style:{fontSize:16}},a),N.createElement("span",{className:"edit-icon"}))),N.createElement(Z.Z,{visible:n},N.createElement(x.Z,{maxLength:20,value:a,onChange:this.onTempTitleChange,onBlur:this.onTempTitleBlur,ref:this.tempTitleRef,style:{width:"50%"}}))),N.createElement("span",{className:"approvalFlow_header_btn_bar"},N.createElement(P.Z,{type:"text",onClick:function(){e.onCancel()}},"取消"),N.createElement(P.Z,{type:"primary",loading:r,onClick:this.onSaveTemp},"保存"))),N.createElement("div",{id:"approvalFlow"},N.createElement("div",{className:"approvalFlow-content-outer"},N.createElement("div",{className:"approvalFlow-content",style:this.state.scaleStyle},this.generateNodeContainer(this.state.approvalFlowData)))),N.createElement(R.Z,{width:"60%",placement:"right",onClose:this.onCloseDrawer,visible:this.state.drawerVisible,id:"approval-flow-drawer",destroyOnClose:!0,afterVisibleChange:this.afterVisibleChange,closable:!1},this.generateDrawerContent()))}}]),l}(N.Component)}}]);